.\" Automatically generated by Podwrapper::Man 1.29.44 (Pod::Simple 3.30)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "virt-p2v 1"
.TH virt-p2v 1 "2015-05-26" "libguestfs-1.29.44" "Virtualization Support"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "名前"
.IX Header "名前"
virt\-p2v \- Convert a physical machine to use \s-1KVM\s0
.SH "書式"
.IX Header "書式"
.Vb 1
\& virt\-p2v
\&
\& virt\-p2v.iso
.Ve
.SH "説明"
.IX Header "説明"
Virt\-p2v converts a physical machine to run virtualized on \s-1KVM,\s0 managed by
libvirt, OpenStack, oVirt, Red Hat Enterprise Virtualisation (\s-1RHEV\s0), or one
of the other targets supported by \fIvirt\-v2v\fR\|(1).
.PP
Normally you don't run the virt\-p2v program directly.  Instead you have to
boot the physical machine using the bootable CD-ROM, \s-1ISO\s0 or \s-1PXE\s0 image.  This
bootable image contains the virt\-p2v binary and runs it automatically.
Booting from a CD\-ROM/etc is required because the disks which are being
converted must be quiescent.  It is not safe to try to convert a running
physical machine where other programs may be modifying the disk content at
the same time.
.PP
This manual page documents running the virt\-p2v program.  To create the
bootable image you should look at \fIvirt\-p2v\-make\-disk\fR\|(1) or
\&\fIvirt\-p2v\-make\-kickstart\fR\|(1).
.SH "NETWORK SETUP"
.IX Header "NETWORK SETUP"
Virt\-p2v runs on the physical machine which you want to convert.  It has to
talk to another server called the \*(L"conversion server\*(R" which must have
\&\fIvirt\-v2v\fR\|(1) installed on it.  It always talks to the conversion server
over \s-1SSH:\s0
.PP
.Vb 5
\& ┌──────────────┐                  ┌─────────────────┐
\& │ virt\-p2v     │                  │ virt\-v2v        │
\& │ (physical    │  ssh connection  │ (conversion     │
\& │  server)   ╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍▶ server)       │
\& └──────────────┘                  └─────────────────┘
.Ve
.PP
The virt\-v2v program on the conversion server does the actual conversion
(physical to virtual, and virtual to virtual conversions are sufficiently
similar that we use the same program to do both).
.PP
The \s-1SSH\s0 connection is always initiated from the physical server.  All data
is transferred over the \s-1SSH\s0 connection.  In terms of firewall and network
configuration, you only need to ensure that the physical server has access
to a port (usually \s-1TCP\s0 port 22) on the conversion server.  Note that the
physical machine may reconnect several times during the conversion process.
.PP
The reverse port forwarding feature of ssh (ie. \f(CW\*(C`ssh \-R\*(C'\fR) is required by
virt\-p2v, and it will not work if this is disabled on the conversion
server.  (\f(CW\*(C`AllowTcpForwarding\*(C'\fR must be \f(CW\*(C`yes\*(C'\fR in the \fIsshd_config\fR\|(5) file
on the conversion server).
.PP
The conversion server does not need to be a physical machine.  It could be a
virtual machine, as long as it has sufficient memory and disk space to do
the conversion, and as long as the physical machine can connect directly to
its \s-1SSH\s0 port.  (See also \*(L"\s-1RESOURCE REQUIREMENTS\*(R"\s0 in \fIvirt\-v2v\fR\|(1)).
.PP
Because all of the data on the physical server's hard drive(s) has to be
copied over the network, the speed of conversion is largely determined by
the speed of the network between the two machines.
.SH "GUI INTERACTIVE CONFIGURATION"
.IX Header "GUI INTERACTIVE CONFIGURATION"
When you start virt\-p2v, you'll see a graphical configuration dialog that
walks you through connection to the conversion server, asks for the
password, which local hard disks you want to convert, and other things like
the name of the guest to create and the number of virtual CPUs to give it.
.SS "\s-1SSH CONFIGURATION DIALOG\s0"
.IX Subsection "SSH CONFIGURATION DIALOG"
When virt\-p2v starts up in \s-1GUI\s0 mode, the first dialog looks like this:
.PP
.Vb 11
\& ┌────────────────────────────────────────────────────────┐
\& │                      virt\-p2v                          │
\& │                                                        │
\& │ Conversion server: [_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\& │                                                        │
\& │          SSH port: [22_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\& │                                                        │
\& │         User name: [root_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\& │                                                        │
\& │          Password: [_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\& │                                                        │
.Ve
.PP
In the fields above, you must enter the hostname, \s-1SSH\s0 port number, remote
user name and password of the conversion server.  The conversion server must
have an up to date version of virt\-v2v.
.PP
Normally you must log in to the conversion server as root, but if you check
the following box:
.PP
.Vb 3
\& │                                                        │
\& │                    [ ] Use sudo when running virt\-v2v  │
\& │                                                        │
.Ve
.PP
then you can log in as another user, and virt\-p2v will use the \fIsudo\fR\|(8)
command to elevate privileges to root.  Note that sudo must not require a
password.
.PP
It is also possible to run virt\-v2v on the conversion server entirely as
non-root, but output modes may be limited.  Consult the \fIvirt\-v2v\fR\|(1)
manual page for details.
.PP
At the bottom of the dialog are these buttons:
.PP
.Vb 6
\& │                                                        │
\& │                [ Test connection ]                     │
\& │                                                        │
\& │ [ Configure network ] [ About virt\-p2v  ] [ Next     ] │
\& │                                                        │
\& └────────────────────────────────────────────────────────┘
.Ve
.PP
You must press the \f(CW\*(C`Test connection\*(C'\fR button first to test the \s-1SSH\s0
connection to the conversion server.  If that is successful (ie. you have
supplied the correct server name, user name, password, etc., and a suitable
version of virt\-v2v is available remotely) then press the \f(CW\*(C`Next\*(C'\fR button to
move to the next dialog.
.PP
You can use the \f(CW\*(C`Configure network\*(C'\fR button if you need to assign a static
\&\s-1IP\s0 address to the physical machine, or use Wifi, bonding or other network
features.
.SS "\s-1DISK AND NETWORK CONFIGURATION DIALOG\s0"
.IX Subsection "DISK AND NETWORK CONFIGURATION DIALOG"
The second configuration dialog lets you configure the details of
conversion, including what to convert and where to send the guest.
.PP
In the left hand column, starting at the top, the target properties let you
select the name of the guest (ie. after conversion) and how many virtual
CPUs and how much \s-1RAM\s0 to give it.  The defaults come from the physical
machine, and you can usually leave them unchanged:
.PP
.Vb 9
\& ┌─────────────────────────────────────── ─ ─ ─ ─
\& │ Target properties:
\& │
\& │        Name: [hostname_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
\& │     # vCPUs: [4_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
\& │ Memory (MB): [16384_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
.Ve
.PP
The second panel on the left controls the virt\-v2v output options.  To
understand these options it is a really good idea to read the \fIvirt\-v2v\fR\|(1)
manual page.  You can leave the options at the default to create a guest as
a disk image plus libvirt \s-1XML\s0 file located in \f(CW\*(C`/var/tmp\*(C'\fR on the conversion
host.  This is a good idea if you are a first-time virt\-p2v user.
.PP
.Vb 10
\& │
\& │ Virt\-v2v output options:
\& │
\& │          Output to (\-o): [local             ▼]
\& │
\& │      Output conn. (\-oc): [_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
\& │    Output storage (\-os): [/var/tmp_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
\& │     Output format (\-of): [_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_]
\& │
\& │ Output allocation (\-oa): [sparse            ▼]
\& │
.Ve
.PP
All output options and paths are relative to the conversion server (\fInot\fR
to the physical server).
.PP
The final option in this panel enables server-side debugging.  This produces
a lot of output, but is essential if you are tracking down virt\-p2v or
virt\-v2v problems, and can generally be left enabled:
.PP
.Vb 3
\& │
\& │ [✔] Enable server\-side debugging
\& │
.Ve
.PP
Finally in the left hand column is an information box giving the version of
virt\-p2v (on the physical server) and virt\-v2v (on the conversion server).
You should supply this information when reporting bugs.
.PP
In the right hand column are three panels which control what hard disks,
removable media devices, and network interfaces, will be created in the
output guest.  Normally leaving these at the default settings is fine.
.PP
.Vb 7
\& ─ ─ ───────────────────────────────────────┐
\&     Fixed hard disks                       │
\&                                            │
\&     Convert  Device  Size (GB)  Model      │
\&     [✔]      sda     1024       HITACHI    │
\&     [✔]      sdb     119        HITACHI    │
\&                                            │
.Ve
.PP
Normally you would want to convert all hard disks.  If you want virt\-p2v to
completely ignore a local hard disk, uncheck it.  The hard disk that
contains the operating system must be selected.  If a hard disk is part of a
\&\s-1RAID\s0 array or \s-1LVM\s0 volume group (\s-1VG\s0), then either all hard disks in that
array/VG must be selected, or none of them.
.PP
.Vb 6
\&                                            │
\&     Removable media                        │
\&                                            │
\&     Convert  Device                        │
\&     [✔]      sr0                           │
\&                                            │
.Ve
.PP
If the physical machine has \s-1CD\s0 or \s-1DVD\s0 drives, then you can use the Removable
media panel to create corresponding drives on the guest after conversion.
Note that any data CDs/DVDs which are mounted in the drives are \fInot\fR
copied over.
.PP
.Vb 7
\&                                            │
\&     Network interfaces                     │
\&                                            │
\&     Convert  Device Connect to ...         |
\&     [✔]      em1    [default_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\&     [ ]      wlp3s0 [default_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_\|_] │
\&                                            │
.Ve
.PP
In the Network interfaces panel, select the network interfaces that should
be created in the guest after conversion.  You can also connect these to
target hypervisor networks (for further information about this feature, see
\&\*(L"\s-1NETWORKS AND BRIDGES\*(R"\s0 in \fIvirt\-v2v\fR\|(1)).
.PP
When you are ready to begin the conversion, press the \f(CW\*(C`Start conversion\*(C'\fR
button:
.PP
.Vb 4
\&                                            │
\&             [ Back ]  [ Start conversion ] │
\&                                            │
\& ─ ─ ───────────────────────────────────────┘
.Ve
.SS "\s-1CONVERSION RUNNING DIALOG\s0"
.IX Subsection "CONVERSION RUNNING DIALOG"
When conversion is running you will see this dialog:
.PP
.Vb 10
\& ┌────────────────────────────────────────────────────────┐
\& │                      virt\-p2v                          │
\& │                                                        │
\& │  ┌──────────────────────────────────────────────────┐  │
\& │  │                                                 ▲│  │
\& │  │                                                  │  │
\& │  │                                                  │  │
\& ∼  ∼                                                  ∼  ∼
\& │  │                                                  │  │
\& │  │                                                  │  │
\& │  │                                                 ▼│  │
\& │  └──────────────────────────────────────────────────┘  │
\& │                                                        │
\& │ Log files ... to /tmp/virt\-p2v\-xxx                     │
\& │                                                        │
\& │ Doing conversion ...                                   │
\& │                                                        │
\& │                                 [ Cancel conversion ]  │
\& │                                                        │
\& └────────────────────────────────────────────────────────┘
.Ve
.PP
In the main scrolling area you will see log messages from the virt\-v2v
process.
.PP
Below the main area, virt\-p2v shows you the location of the directory on the
conversion server that contains log files and other debugging information.
Below that is the current status and a button for cancelling conversion.
.PP
Once conversion has finished, you should shut down the physical machine.  If
conversion is successful, you should never reboot it.
.SH "KERNEL COMMAND LINE CONFIGURATION"
.IX Header "KERNEL COMMAND LINE CONFIGURATION"
If you don't want to configure things using the graphical \s-1UI,\s0 an alternative
is to configure through the kernel command line.  This is especially
convenient if you are converting a lot of physical machines which are booted
using \s-1PXE.\s0
.PP
Where exactly you set command line arguments depends on your \s-1PXE\s0
implementation, but for pxelinux you put them in the \f(CW\*(C`APPEND\*(C'\fR field in the
\&\f(CW\*(C`pxelinux.cfg\*(C'\fR file.  For example:
.PP
.Vb 6
\& DEFAULT p2v
\& TIMEOUT 20
\& PROMPT 0
\& LABEL p2v
\&   KERNEL virt\-p2v\-vmlinuz
\&   APPEND initrd=virt\-p2v\-initrd p2v.server=conv.example.com p2v.password=secret p2v.o=libvirt
.Ve
.PP
You have to set some or all of the following command line arguments:
.IP "\fBp2v.server=SERVER\fR" 4
.IX Item "p2v.server=SERVER"
The name or \s-1IP\s0 address of the conversion server.
.Sp
This is always required if you are using the kernel configuration method.
If virt\-p2v does not find this on the kernel command line then it switches
to the \s-1GUI \s0(interactive) configuration method.
.IP "\fBp2v.port=NN\fR" 4
.IX Item "p2v.port=NN"
The \s-1SSH\s0 port number on the conversion server (default: \f(CW22\fR).
.IP "\fBp2v.username=USERNAME\fR" 4
.IX Item "p2v.username=USERNAME"
The \s-1SSH\s0 username that we log in as on the conversion server (default:
\&\f(CW\*(C`root\*(C'\fR).
.IP "\fBp2v.password=PASSWORD\fR" 4
.IX Item "p2v.password=PASSWORD"
The \s-1SSH\s0 password that we use to log in to the conversion server.
.Sp
The default is to try with no password.  If this fails then virt\-p2v will
ask the user to type the password (probably several times during
conversion).
.Sp
Note that virt\-p2v does not support authentication using key distribution at
this time.
.IP "\fBp2v.sudo\fR" 4
.IX Item "p2v.sudo"
Use \f(CW\*(C`p2v.sudo\*(C'\fR to tell virt\-p2v to use \fIsudo\fR\|(8) to gain root privileges
on the conversion server after logging in as a non-root user (default: do
not use sudo).
.IP "\fBp2v.name=GUESTNAME\fR" 4
.IX Item "p2v.name=GUESTNAME"
The name of the guest that is created.  The default is to try to derive a
name from the physical machine's hostname (if possible) else use a randomly
generated name.
.IP "\fBp2v.vcpus=NN\fR" 4
.IX Item "p2v.vcpus=NN"
The number of virtual CPUs to give to the guest.  The default is to use the
same as the number of physical CPUs.
.IP "\fBp2v.memory=NN(M|G)\fR" 4
.IX Item "p2v.memory=NN(M|G)"
The size of the guest memory.  You can specify this in megabytes or
gigabytes by using (eg) \f(CW\*(C`p2v.memory=1024M\*(C'\fR or \f(CW\*(C`p2v.memory=1G\*(C'\fR.  The
default is to use the same amount of \s-1RAM\s0 as on the physical machine.
.IP "\fBp2v.debug\fR" 4
.IX Item "p2v.debug"
Use this to enable full debugging of virt\-v2v.
.Sp
If asked to diagnose a problem with virt\-p2v, you should add \f(CW\*(C`p2v.debug\*(C'\fR to
the kernel command line, and examine the log file which is left in \f(CW\*(C`/tmp\*(C'\fR
on the conversion server.
.IP "\fBp2v.disks=sdX,sdY,..\fR" 4
.IX Item "p2v.disks=sdX,sdY,.."
A list of physical hard disks to convert, for example:
.Sp
.Vb 1
\& p2v.disks=sda,sdc
.Ve
.Sp
The default is to convert all local hard disks that are found.
.IP "\fBp2v.removable=srX,srY,..\fR" 4
.IX Item "p2v.removable=srX,srY,.."
A list of removable media to convert.  The default is to create virtual
removable devices for every physical removable device found.  Note that the
content of removable media is never copied over.
.IP "\fBp2v.interfaces=em1,..\fR" 4
.IX Item "p2v.interfaces=em1,.."
A list of network interfaces to convert.  The default is to create virtual
network interfaces for every physical network interface found.
.IP "\fBp2v.network=interface:target,...\fR" 4
.IX Item "p2v.network=interface:target,..."
Controls how network interfaces are connected to virtual networks on the
target hypervisor.  The default is to connect all network interfaces to the
target \f(CW\*(C`default\*(C'\fR network.
.Sp
You give a comma-separated list of \f(CW\*(C`interface:target\*(C'\fR pairs, plus
optionally a default target.  For example:
.Sp
.Vb 1
\& p2v.network=em1:rhevm
.Ve
.Sp
maps interface \f(CW\*(C`em1\*(C'\fR to target network \f(CW\*(C`rhevm\*(C'\fR.
.Sp
.Vb 1
\& p2v.network=em1:rhevm,em2:management,other
.Ve
.Sp
maps interface \f(CW\*(C`em1\*(C'\fR to \f(CW\*(C`rhevm\*(C'\fR, and \f(CW\*(C`em2\*(C'\fR to \f(CW\*(C`management\*(C'\fR, and any
other interface that is found to \f(CW\*(C`other\*(C'\fR.
.IP "\fBp2v.o=[libvirt|local|...]\fR" 4
.IX Item "p2v.o=[libvirt|local|...]"
Set the output mode.  This is the same as the virt\-v2v \fI\-o\fR option.  See
\&\*(L"\s-1OPTIONS\*(R"\s0 in \fIvirt\-v2v\fR\|(1).
.Sp
If not specified, the default is \f(CW\*(C`local\*(C'\fR, and the converted guest is
written to \f(CW\*(C`/var/tmp\*(C'\fR.
.IP "\fBp2v.oa=sparse|preallocated\fR" 4
.IX Item "p2v.oa=sparse|preallocated"
Set the output allocation mode.  This is the same as the virt\-v2v \fI\-oa\fR
option.  See \*(L"\s-1OPTIONS\*(R"\s0 in \fIvirt\-v2v\fR\|(1).
.IP "\fBp2v.oc=...\fR" 4
.IX Item "p2v.oc=..."
Set the output connection libvirt \s-1URI. \s0 This is the same as the virt\-v2v
\&\fI\-oc\fR option.  See \*(L"\s-1OPTIONS\*(R"\s0 in \fIvirt\-v2v\fR\|(1) and
http://libvirt.org/uri.html
.IP "\fBp2v.of=raw|qcow2|...\fR" 4
.IX Item "p2v.of=raw|qcow2|..."
Set the output format.  This is the same as the virt\-v2v \fI\-of\fR option.  See
\&\*(L"\s-1OPTIONS\*(R"\s0 in \fIvirt\-v2v\fR\|(1).
.IP "\fBp2v.os=...\fR" 4
.IX Item "p2v.os=..."
Set the output storage.  This is the same as the virt\-v2v \fI\-os\fR option.
See \*(L"\s-1OPTIONS\*(R"\s0 in \fIvirt\-v2v\fR\|(1).
.Sp
If not specified, the default is \f(CW\*(C`/var/tmp\*(C'\fR (on the conversion server).
.IP "\fBip=dhcp\fR" 4
.IX Item "ip=dhcp"
Use \s-1DHCP\s0 for configuring the network interface (this is the default).
.SH "オプション"
.IX Header "オプション"
.IP "\fB\-\-help\fR" 4
.IX Item "--help"
ヘルプを表示します。
.IP "\fB\-\-cmdline=CMDLINE\fR" 4
.IX Item "--cmdline=CMDLINE"
This is used for debugging. Instead of parsing the kernel command line from
\&\f(CW\*(C`/proc/cmdline\*(C'\fR, parse the string parameter \f(CW\*(C`CMDLINE\*(C'\fR.
.IP "\fB\-v\fR" 4
.IX Item "-v"
.PD 0
.IP "\fB\-\-verbose\fR" 4
.IX Item "--verbose"
.PD
Enable debugging (on the conversion server).
.IP "\fB\-V\fR" 4
.IX Item "-V"
.PD 0
.IP "\fB\-\-version\fR" 4
.IX Item "--version"
.PD
バージョン番号を表示して、終了します。
.SH "HOW VIRT\-P2V WORKS"
.IX Header "HOW VIRT-P2V WORKS"
\&\fBNote this section is not normative.\fR We may change how virt\-p2v works at
any time in the future.
.PP
As described above, virt\-p2v runs on a physical machine, interrogates the
user or the kernel command line for configuration, and then establishes one
or more ssh connections to the virt\-v2v conversion server.  The ssh
connections are interactive shell sessions to the remote host, but the
commands sent are generated entirely by virt\-p2v itself, not by the user.
For data transfer, virt\-p2v will use the reverse port forward feature of ssh
(ie. \f(CW\*(C`ssh \-R\*(C'\fR).
.PP
It will first make one or more test connections, which are used to query the
remote version of virt\-v2v and its features.  The test connections are
closed before conversion begins.
.PP
.Vb 5
\& ┌──────────────┐                      ┌─────────────────┐
\& │ virt\-p2v     │                      │ virt\-v2v        │
\& │ (physical    │  control connection  │ (conversion     │
\& │  server)   ╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍▶ server)       │
\& └──────────────┘                      └─────────────────┘
.Ve
.PP
Once virt\-p2v is ready to start conversion, it will open a single ssh
control connection.  It first sends a mkdir command to create a temporary
directory on the conversion server.  The directory name is randomly chosen
and is displayed in the \s-1GUI. \s0 It has the form:
.PP
.Vb 1
\& /tmp/virt\-p2v\-YYYYMMDD\-XXXXXXXX
.Ve
.PP
where \f(CW\*(C`YYYYMMDD\*(C'\fR is the current date, and the X's are random characters.
.PP
Into this directory are written various files which include:
.ie n .IP """name""" 4
.el .IP "\f(CWname\fR" 4
.IX Item "name"
\&\fIbefore conversion\fR
.Sp
The name (usually the hostname) of the physical machine.
.ie n .IP """physical.xml""" 4
.el .IP "\f(CWphysical.xml\fR" 4
.IX Item "physical.xml"
\&\fIbefore conversion\fR
.Sp
Libvirt \s-1XML\s0 describing the physical machine.  It is used to pass data about
the physical source host to \fIvirt\-v2v\fR\|(1) via the \fI\-i libvirtxml\fR option.
.Sp
Note this is not \*(L"real\*(R" libvirt \s-1XML \s0(and must \fBnever\fR be loaded into
libvirt, which would reject it anyhow).  Also it is not the same as the
libvirt \s-1XML\s0 which virt\-v2v generates in certain output modes.
.ie n .IP """status""" 4
.el .IP "\f(CWstatus\fR" 4
.IX Item "status"
\&\fIafter conversion\fR
.Sp
The final status of the conversion.  \f(CW0\fR if the conversion was successful.
Non-zero if the conversion failed.
.ie n .IP """time""" 4
.el .IP "\f(CWtime\fR" 4
.IX Item "time"
\&\fIbefore conversion\fR
.Sp
The start date/time of conversion.
.ie n .IP """virt\-v2v\-conversion\-log.txt""" 4
.el .IP "\f(CWvirt\-v2v\-conversion\-log.txt\fR" 4
.IX Item "virt-v2v-conversion-log.txt"
\&\fIduring/after conversion\fR
.Sp
The conversion log.  This is just the output of the virt\-v2v command on the
conversion server.  If conversion fails, you should examine this log file,
and you may be asked to supply the \fBcomplete\fR, \fBunedited\fR log file in any
bug reports or support tickets.
.PP
Before conversion actually begins, virt\-p2v then makes one or more further
ssh connections to the server for data transfer.  The transfer protocol used
currently is \s-1NBD \s0(Network Block Device), which is proxied over ssh.  The
server is \fIqemu\-nbd\fR\|(1).  There is one ssh connection per physical hard
disk on the source machine (the common case — a single hard disk — is shown
below):
.PP
.Vb 11
\& ┌──────────────┐                      ┌─────────────────┐
\& │ virt\-p2v     │                      │ virt\-v2v        │
\& │ (physical    │  control connection  │ (conversion     │
\& │  server)   ╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍▶ server)       │
\& │              │                      │                 │
\& │              │  data connection     │                 │
\& │            ╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍▶               │
\& │qemu\-nbd ← ─┘ │                      │└─ ← NBD         │
\& │/dev/sda      │                      │     requests    │
\& ∼              ∼                      ∼                 ∼
\& └──────────────┘                      └─────────────────┘
.Ve
.PP
Although the ssh data connection is originated from the physical server and
terminates on the conversion server, in fact \s-1NBD\s0 requests flow in the
opposite direction.  This is because the reverse port forward feature of ssh
(\f(CW\*(C`ssh \-R\*(C'\fR) is used to open a port on the loopback interface of the
conversion server which is proxied back by ssh to the qemu-nbd server
running on the physical machine.  The effect is that virt\-v2v via libguestfs
can open nbd connections which directly read the hard disk(s) of the
physical server.
.PP
Two layers of protection are used to ensure that there are no writes to the
hard disks: Firstly, the qemu-nbd \fI\-r\fR (readonly) option is used.  Secondly
libguestfs creates an overlay on top of the \s-1NBD\s0 connection which stores
writes in a temporary file on the conversion file.
.PP
The final step is to send the \f(CW\*(C`virt\-v2v \-i libvirtxml physical.xml ...\*(C'\fR
command to the conversion server over the control connection.  This
references the \f(CW\*(C`physical.xml\*(C'\fR file (see above), which in turn references
the \s-1NBD\s0 listening port(s) of the data connection(s).
.PP
Output from the virt\-v2v command (messages, debugging etc) is saved both in
the log file on the conversion server, and sent over the control connection
to be displayed in the graphical \s-1UI.\s0
.SH "関連項目"
.IX Header "関連項目"
\&\fIvirt\-p2v\-make\-disk\fR\|(1), \fIvirt\-p2v\-make\-kickstart\fR\|(1), \fIvirt\-v2v\fR\|(1),
\&\fIqemu\-nbd\fR\|(1), \fIssh\fR\|(1), \fIsshd\fR\|(8), \fIsshd_config\fR\|(5),
http://libguestfs.org/.
.SH "著者"
.IX Header "著者"
Matthew Booth
.PP
John Eckersberg
.PP
Richard W.M. Jones http://people.redhat.com/~rjones/
.PP
Mike Latimer
.PP
Pino Toscano
.PP
Tingting Zheng
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2009\-2015 Red Hat Inc.
.SH "LICENSE"
.IX Header "LICENSE"
.SH "BUGS"
.IX Header "BUGS"
To get a list of bugs against libguestfs, use this link:
https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&product=Virtualization+Tools
.PP
To report a new bug against libguestfs, use this link:
https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&product=Virtualization+Tools
.PP
When reporting a bug, please supply:
.IP "\(bu" 4
The version of libguestfs.
.IP "\(bu" 4
Where you got libguestfs (eg. which Linux distro, compiled from source, etc)
.IP "\(bu" 4
Describe the bug accurately and give a way to reproduce it.
.IP "\(bu" 4
Run \fIlibguestfs\-test\-tool\fR\|(1) and paste the \fBcomplete, unedited\fR
output into the bug report.
