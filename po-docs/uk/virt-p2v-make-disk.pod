
=head1 НАЗВА

virt-p2v-make-disk — збирання диска virt-p2v за допомогою virt-builder

=head1 КОРОТКИЙ ОПИС

 virt-p2v-make-disk -o /dev/sdX [версія ОС]

=head1 ОПИС

L<virt-p2v(1)> перетворює фізичну машину для запуску віртуалізованою у KVM,
під керуванням libvirt, OpenStack, oVirt, Red Hat Enterprise Virtualisation
(RHEV) або одним із інших призначень, підтримку яких передбачено у
L<virt-v2v(1)>.

virt-p2v-make-disk — скрипт, який створює придатний до завантаження образ
диска або флешки USB, на якому міститься virt-p2v. Для виконання завдань
програма використовує L<virt-builder(1)>. Сама ж програма є невеличким
скриптом командної оболонки, призначеним для керування virt-builder.

За допомогою обов'язкового параметра I<-o> визначається місце, куди слід
записати виведені дані, наприклад флешка USB (приклад: C<-o /dev/sdX>) або
файл. Якщо вами буде передано назву пристрою, B<наявні на пристрої дані буде
витерто>.

=head2 Параметр C<os-version>

Необов'язковий параметр C<os-version> визначає базовий дистрибутив Linux,
який буде використано для створення операційної системи на образі ISO. Якщо
ви не вкажете цей параметр, скрипт намагатиметься вибрати відповідне типове
значення для вашої системи. У більшості користувачів I<не> має виникати
потреби у використанні параметра C<os-version>.

Базова операційна система, яку вибрано для virt-p2v, ніяким чином не
пов'язана із операційною системою фізичної машини, яку ви хочете
перетворити.

Щоб побачити список можливих комбінацій C<os-version>, віддайте таку
команду:

 virt-builder -l

=head1 ПРИКЛАДИ

Записати придатну до завантаження флешку USB з virt-p2v на F</dev/sdX> (усі
наявні на F</dev/sdX> дані буде витерто):

 virt-p2v-make-disk -o /dev/sdX

Записати придатний до завантаження образ віртуального диска virt-p2v і
завантажити його під qemu:

 virt-p2v-make-disk -o /var/tmp/p2v.img fedora-
 qemu-kvm -m 1024 -boot c \
   -drive file=/var/tmp/p2v.img,if=virtio,index=0 \
   -drive file=/var/tmp/guest.img,if=virtio,index=1

де F</var/tmp/guest.img> — образ диска якоїсь гостьової системи, яку ви
хочете перетворити (лише для тестування).

=head1 ДОДАВАННЯ ДОДАТКОВИХ ПАКУНКІВ

Встановити нові пакунки можна за допомогою параметра
I<--install>. Встановлення нових пакунків може бути корисним для створення
повнофункціонального диска virt-p2v із додатковими інструментами для
діагностики та усування вад. Як аргумент параметра слід вказати список
пакунків, відокремлених комами. Приклад:

 virt-p2v-make-disk -o /var/tmp/p2v.img --install tcpdump,traceroute

=head1 ДОДАВАННЯ ПРОФІЛЮ SSH

Ви можете вставити файл профілю SSH (закритий ключ) до образу за допомогою
параметра I<--inject-ssh-identity>.

Спочатку створіть пару ключів. Пароль до пари ключів має бути порожнім:

 ssh-keygen -t rsa -N '' -f id_rsa

Ця команда створить закритий ключ (C<id_rsa>) і відкритий ключ
(C<id_rsa.pub>). Відкритий ключ слід дописати до файла C<authorized_keys> на
сервері перетворення virt-v2v (зазвичай, до файла
C</root/.ssh/authorized_keys>).

Закритий ключ має бути вписано на образ диска, а потім витерто:

 virt-p2v-make-disk [...] --inject-ssh-identity id_rsa
 rm id_rsa

При завантаженні virt-p2v вкажіть адресу вставленого файла ось так:

 │         Користувач: [root____________________________] │
 │                                                        │
 │          Пароль: [      <не заповнюйте>                 ] │
 │                                                        │
 │  Адреса профілю SSH: [file:///var/tmp/id_rsa_______] │

або, якщо використовується командний рядок ядра, додайте:

 p2v.identity=file:///var/tmp/id_rsa

Докладніший опис наведено у розділі L<virt-p2v(1)/ПРОФІЛІ SSH>.

=head1 32-БІТОВА VIRT-P2V

Для поліпшення сумісності із застарілим обладнанням у virt-p2v-make-disk
передбачено параметр I<--arch>. Найкориснішим параметром (на основних
системах архітектури x86-64) є параметр I<--arch i686>, який надає змогу
зібрати 32-бітове середовище virt-p2v, яке працюватиме на застарілому
обладнанні. 32-бітова версія virt-p2v може перетворювати 64-бітові фізичні
машини і може працювати із 64-бітовим virt-v2v та 64-бітовими гіпервізорами.

Щоб скористатися цим параметром вам слід зібрати у якийсь спосіб
F<virt-p2v.$arch> (зазвичай, F<virt-p2v.i686>) і встановити його поряд із
звичайним виконуваним файлом F<virt-p2v> (наприклад, до F<$libdir/virt-p2v/>
або C<$VIRT_V2V_DATA_DIR>). Опис процедури не є предметом цієї сторінки
підручника, втім, ви можете знайти настанови у розділі
L<guestfs-building(1)/ЗБИРАННЯ VIRT-P2V ДЛЯ 32-БІТОВОЇ АРХІТЕКТУРИ i686>.

=head1 ПАРАМЕТРИ

=over 4

=item B<--help>

Показати довідкове повідомлення.

=item B<--arch> АРХІТЕКТУРА

Встановити архітектуру образу ISO із virt-p2v. Див. L</32-БІТОВА VIRT-P2V>
вище.

Якщо цей параметр не вказано, типово буде використано ту саму архітектуру,
що і архітектура основної системи, у якій запущено virt-p2v-make-disk.

=item B<--inject-ssh-identity> id_rsa

Додати файл профілю SSH (закритий ключ) до образу. Див. L</ДОДАВАННЯ ПРОФІЛЮ
SSH> вище.

=item B<--install> пакунок,пакунок,...

Додати до образу додаткові пакунки. Див. L</ДОДАВАННЯ ДОДАТКОВИХ ПАКУНКІВ>
вище.

=item B<--no-warn-if-partition>

Зазвичай, вам не слід записувати дані на розділ диска USB (тобто не слід
користуватися S<C<-o /dev/sdX1>>, користуйтеся S<C<-o /dev/sdX>> для
створення придатного до завантаження диска USB). Якщо ви спробуєте створити
придатний до запису диск, virt-builder виведе попередження. За допомогою
цього параметра можна придушити попередження.

=item B<-o> ВИВЕДЕННЯ

=item B<--output> ВИВЕДЕННЯ

Записати виведені дані до C<ВИВЕДЕННЯ>, яким може бути локальний файл або
блоковий пристрій. B<Наявний вміст пристрою буде витерто>.

=item B<-v>

=item B<--verbose>

Увімкнути режим докладних повідомлень. Скористайтеся цим параметром, якщо
вам потрібно діагностувати джерело проблеми зі скриптом або створити
докладний звіт щодо вади у бібліотеці.

=item B<-V>

=item B<--version>

Показати дані щодо версії і завершити роботу.

=back

=head1 ФАЙЛИ

=over 4

=item F<$libdir/virt-p2v/virt-p2v.xz>

Виконуваний файл L<virt-p2v(1)>, який буде скопійовано на придатний до
завантаження образ диска.

Розташування виконуваного файла можна змінити за допомогою встановлення
відповідного значення змінної середовища C<VIRT_P2V_DATA_DIR>.

=item F<$datadir/virt-p2v/issue>

=item F<$datadir/virt-p2v/launch-virt-p2v.in>

=item F<$datadir/virt-p2v/p2v.service>

Різноманітні файли даних, які копіюються на образ диска, придатного до
завантаження.

Розташування цих файлів можна змінити за допомогою встановлення відповідного
значення змінної середовища C<VIRT_P2V_DATA_DIR>.

=back

=head1 ЗМІННІ СЕРЕДОВИЩА

=over 4

=item C<VIRT_P2V_DATA_DIR>

Каталог, у якому virt-p2v-make-disk шукатиме файли даних (див. L</ФАЙЛИ>
вище). Якщо значення не встановлено, буде використано вказане під час
компіляції місце.

=back

=head1 ТАКОЖ ПЕРЕГЛЯНЬТЕ

L<virt-p2v(1)>, L<virt-p2v-make-kickstart(1)>, L<virt-p2v-make-kiwi(1)>,
L<virt-v2v(1)>, L<http://libguestfs.org/>.

=head1 АВТОРИ

Richard W.M. Jones L<http://people.redhat.com/~rjones/>

=head1 АВТОРСЬКІ ПРАВА

Copyright (C) 2009-2019 Red Hat Inc.

