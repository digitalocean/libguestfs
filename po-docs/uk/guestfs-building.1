.\" Automatically generated by Podwrapper::Man 1.40.2 (Pod::Simple 3.35)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "guestfs-building 1"
.TH guestfs-building 1 "2019-02-07" "libguestfs-1.40.2" "Virtualization Support"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "НАЗВА"
.IX Header "НАЗВА"
guestfs-building \*(-- як зібрати libguestfs з початкових кодів
.SH "ОПИС"
.IX Header "ОПИС"
На цій сторінці підручника наведено настанови щодо того, як зібрати
libguestfs з початкових кодів.
.PP
Основні кроки:
.IP "\(bu" 4
Встановити вимоги.
.IP "\(bu" 4
Збирання, з коду зі сховища git або з архіву з кодом.
.IP "\(bu" 4
Виконати тестування.
.IP "\(bu" 4
Запуск засобів з каталогу з початковим кодом або встановлення.
.SH "ВИМОГИ"
.IX Header "ВИМОГИ"
.SS "Настанови для користувачів Fedora або Red Hat Enterprise Linux (\s-1RHEL\s0)"
.IX Subsection "Настанови для користувачів Fedora або Red Hat Enterprise Linux (RHEL)"
У Fedora для встановлення усіх потрібних пакунків слід користуватися
\&\fBdnf\fR\|(8):
.PP
.Vb 2
\& dnf builddep libguestfs
\& dnf install autoconf automake libtool gettext\-devel
.Ve
.PP
У системах, де все ще використовується \fByum\fR\|(8), можна скористатися ним:
.PP
.Vb 2
\& yum\-builddep libguestfs
\& yum install autoconf automake libtool gettext\-devel
.Ve
.SS "Настанови для користувачів Debian або Ubuntu"
.IX Subsection "Настанови для користувачів Debian або Ubuntu"
Скористайтеся \s-1APT\s0 для встановлення усіх потрібних пакунків:
.PP
.Vb 2
\& apt\-get build\-dep libguestfs
\& apt\-get install autoconf automake libtool\-bin gettext
.Ve
.PP
Якщо ця команда не працює, зверніть увагу на пакунок із початковим кодом
Debian http://packages.debian.org/source/libguestfs, на список
\&\f(CW\*(C`build\-depends\*(C'\fR і \f(CW\*(C`build\-depends\-indep\*(C'\fR, і встановіть усі пакунки зі
списку.
.SS "Повний список вимог"
.IX Subsection "Повний список вимог"
.IP "\fIappliance/packagelist.in\fR" 4
.IX Item "appliance/packagelist.in"
Встановити якомога більше пакунків із назвами з цього файла. (Без строгої
вимоги встановити геть усі з цих пакунків.)
.Sp
\&\fIЗауваження\fR: якщо ви збираєте libguestfs із наступним встановленням
пакунків базової системи, під час збирання ці пакунки не буде вибрано
автоматично, навіть якщо вами було віддано команду \f(CW\*(C`make clean\*(C'\fR.  Вам
доведеться віддати ще й цю команду, щоб очистити стару базову систему
supermin і примусово приготувати нову:
.Sp
.Vb 1
\& make \-C appliance clean\-supermin\-appliance
.Ve
.IP "qemu ≥ 1.3.0" 4
.IX Item "qemu ≥ 1.3.0"
\&\fIОбов’язкове\fR.
.IP "qemu-img ≥ 1.3.0" 4
.IX Item "qemu-img ≥ 1.3.0"
\&\fIОбов'язкове\fR. Для роботи virt\-p2v та virt\-v2v потрібна qemu-img ≥
2.2.0.
.IP "ядро ≥ 2.6.34" 4
.IX Item "ядро ≥ 2.6.34"
\&\fIОбов'язкове\fR. Має бути увімкнено такі можливості: \f(CW\*(C`virtio\-pci\*(C'\fR,
\&\f(CW\*(C`virtio\-serial\*(C'\fR, \f(CW\*(C`virtio\-block\*(C'\fR, \f(CW\*(C`virtio\-net\*(C'\fR.
.IP "supermin ≥ 5.1.0" 4
.IX Item "supermin ≥ 5.1.0"
\&\fIОбов'язковий\fR. Зі списком альтернативних варіантів можна ознайомитися у
розділі \*(L"ВИКОРИСТАННЯ ПОПЕРЕДНЬО ЗІБРАНОЇ БІНАРНОЇ ОСНОВНОЇ СИСТЕМИ\*(R"
нижче.
.IP "glibc" 4
.IX Item "glibc"
\&\fIОбов'язковий\fR. Ми використовуємо розширення для нетипових засобів
форматування printf для glibc (див. \*(L"НЕТИПОВІ ЗАСОБИ
ФОРМАТУВАННЯ \s-1PRINTF\s0 У ФОНОВІЙ СЛУЖБІ\*(R" in \fBguestfs\-hacking\fR\|(1)).
.IP "\s-1XDR\s0 (tirpc, glibc або інша)" 4
.IX Item "XDR (tirpc, glibc або інша)"
\&\fIОбов'язковий\fR. Ми використовуємо реалізацію \s-1XDR\s0 з \f(CW\*(C`<rpc/xdr.h>\*(C'\fR,
яка може походити з glibc, tirpc або іншої бібліотеки.
.Sp
Програма \f(CW\*(C`rpcgen\*(C'\fR є необов'язковою. Вона знадобиться, лише якщо ви хочете
зібрати програми з git і/або накласти на libguestfs латку із новим
програмним інтерфейсом.
.IP "Gcc або Clang" 4
.IX Item "Gcc або Clang"
\&\fIОбов'язковий\fR. Ми використовуємо \f(CW\*(C`_\|_attribute_\|_((cleanup))\*(C'\fR, розширення
\&\s-1GCC,\s0 підтримку якого передбачено і у Clang.
.IP "Perl" 4
.IX Item "Perl"
\&\fIОбов'язковий\fR. Різноманітні засоби збирання та тестування написано мовою
Perl. Perl не потрібен для роботи із самою бібліотекою, хіба що вам потрібен
один із небагатьох інструментів віртуалізації, які усе ще написано мовою
програмування Perl.
.ie n .IP "Perl ""Pod::Man""" 4
.el .IP "Perl \f(CWPod::Man\fR" 4
.IX Item "Perl Pod::Man"
.PD 0
.ie n .IP "Perl ""Pod::Simple""" 4
.el .IP "Perl \f(CWPod::Simple\fR" 4
.IX Item "Perl Pod::Simple"
.PD
\&\fIОбов’язкове\fR. Частина ядра Perl.
.IP "OCaml ≥ 4.01" 4
.IX Item "OCaml ≥ 4.01"
.PD 0
.IP "OCaml findlib" 4
.IX Item "OCaml findlib"
.PD
\&\fIОбов’язкове\fR.
.IP "autoconf" 4
.IX Item "autoconf"
.PD 0
.IP "automake" 4
.IX Item "automake"
.IP "gettext" 4
.IX Item "gettext"
.PD
\&\fIОбов'язкове\fR, якщо збирається версія з git. Необов'язкове, якщо збирання
відбувається з архіву tar.
.IP "cpio" 4
.IX Item "cpio"
\&\fIОбов’язкове\fR.
.IP "gperf" 4
.IX Item "gperf"
\&\fIОбов’язкове\fR.
.IP "flex" 4
.IX Item "flex"
.PD 0
.IP "bison" 4
.IX Item "bison"
.PD
\&\fIОбов’язкове\fR.
.IP "Бібліотека для роботи із сумісними з Perl формальними виразами (\s-1PCRE\s0)" 4
.IX Item "Бібліотека для роботи із сумісними з Perl формальними виразами (PCRE)"
\&\fIОбов’язкове\fR.
.IP "genisoimage" 4
.IX Item "genisoimage"
\&\fIОбов’язкове\fR.
.IP "libxml2" 4
.IX Item "libxml2"
\&\fIОбов’язкове\fR.
.IP "ncurses" 4
.IX Item "ncurses"
\&\fIОбов’язкове\fR.
.IP "augeas ≥ 1.0.0" 4
.IX Item "augeas ≥ 1.0.0"
\&\fIОбов’язкове\fR.
.IP "xz" 4
.IX Item "xz"
\&\fIОбов’язкове\fR.
.IP "Jansson ≥ 2.7" 4
.IX Item "Jansson ≥ 2.7"
\&\fIОбов’язкове\fR.
.IP "po4a" 4
.IX Item "po4a"
\&\fIОбов'язкове\fR, якщо збирається версія з git. Необов'язкове, якщо збирання
відбувається з архіву tar.
.IP "hivex ≥ 1.2.7" 4
.IX Item "hivex ≥ 1.2.7"
.PD 0
.IP "ocaml-hivex" 4
.IX Item "ocaml-hivex"
.PD
\&\fIОбов'язковий\fR. ocaml-hivex є прив'язкою OCaml для hivex, яка потрібна для
збирання фонової служби.
.IP "libmagic" 4
.IX Item "libmagic"
\&\fIОбов'язковий\fR. Це бібліотека, яка використовується програмою \fBfile\fR\|(1).
.IP "libvirt ≥ 0.10.2" 4
.IX Item "libvirt ≥ 0.10.2"
Необов'язкове. Завжди використовуйте найсвіжішу версію libvirt.
.IP "xmllint" 4
.IX Item "xmllint"
Необов’язкове. Використовується лише для тестування.
.IP "libconfig" 4
.IX Item "libconfig"
Необов'язкове. Використовується для обробки у libguestfs власних файлів
налаштувань, наприклад \fI/etc/libguestfs\-tools.conf\fR.
.IP "libselinux" 4
.IX Item "libselinux"
Необов'язковий. Використовується модулем libvirt для
безпечного ізолювання базової системи (sVirt).
.IP "Засоби Berkeley \s-1DB\s0 (db_dump, db_load тощо)" 4
.IX Item "Засоби Berkeley DB (db_dump, db_load тощо)"
Необов'язкові. Зазвичай, можна знайти у пакунках із назвами \f(CW\*(C`db\-utils\*(C'\fR,
\&\f(CW\*(C`db4\-utils\*(C'\fR, \f(CW\*(C`db4.X\-utils\*(C'\fR тощо.
.IP "systemtap" 4
.IX Item "systemtap"
Не обов'язкове. Для зондування простору користувача.
.IP "readline" 4
.IX Item "readline"
Необов'язкове. Для красивішого редагування рядків у \fBguestfish\fR\|(1).
.IP "acl" 4
.IX Item "acl"
Необов'язкове. Бібліотека і програми для обробки списків керування доступом
(\s-1ACL\s0) \s-1POSIX.\s0
.IP "libcap" 4
.IX Item "libcap"
Необов'язкове. Бібліотека і програми для обробки можливостей Linux.
.IP "libldm" 4
.IX Item "libldm"
Необов'язкове. Бібліотека та \fBldmtool\fR\|(1) для обробки динамічних дисків
Windows.
.IP "sd-journal" 4
.IX Item "sd-journal"
Необов'язкове. Бібліотека для доступу до журналів systemd.
.IP "gdisk" 4
.IX Item "gdisk"
Необов'язкове. Підтримка дисків \s-1GPT.\s0
.IP "netpbm" 4
.IX Item "netpbm"
Необов'язкове. Обробка піктограм з гостьових систем.
.IP "icoutils" 4
.IX Item "icoutils"
Необов'язкове. Обробка піктограм із гостьових систем Windows.
.ie n .IP "Perl ""Expect""" 4
.el .IP "Perl \f(CWExpect\fR" 4
.IX Item "Perl Expect"
Необов'язкове. Модуль Perl, який використовується для тестування
\&\fBvirt\-rescue\fR\|(1).
.IP "\s-1FUSE\s0" 4
.IX Item "FUSE"
Необов'язковий. \fBfusermount\fR\|(1), libfuse та модуль ядра потрібні, якщо вам
потрібна \fBguestmount\fR\|(1) і/або підтримка mount-local.
.IP "статичний glibc" 4
.IX Item "статичний glibc"
Необов'язковий. Використовується лише для тестування.
.IP "qemu-nbd" 4
.IX Item "qemu-nbd"
.PD 0
.IP "nbdkit" 4
.IX Item "nbdkit"
.PD
Необов'язкове. qemu-nbd використовується для тестування.
.Sp
\&\fBvirt\-p2v\fR\|(1) потребує qemu-nbd або nbdkit, але ці програми мають бути лише
на образі \s-1ISO\s0 virt\-p2v, вони не потрібні на час компіляції.
.IP "uml_mkcow" 4
.IX Item "uml_mkcow"
Необов'язковий. Призначено для модуля \s-1UML\s0.
.IP "curl" 4
.IX Item "curl"
Необов'язкове. Використовується virt-builder для отримання даних.
.IP "\s-1GNU\s0 Privacy Guard (GnuPG, gpg) версії 1 або 2" 4
.IX Item "GNU Privacy Guard (GnuPG, gpg) версії 1 або 2"
Необов'язкове. Використовується virt-builder для перевіряння цифрових
підписів.
.IP "liblzma" 4
.IX Item "liblzma"
Необов'язковий. Якщо доступний, virt-builder скористається цією бібліотекою
для швидкого паралельного розпаковування шаблонів.
.IP "Gtk ≥ 2.24 або 3" 4
.IX Item "Gtk ≥ 2.24 або 3"
Необов'язкове.
.Sp
Використовується графічним інтерфейсом virt\-p2v.
.Sp
Може бути використано Gtk 2 або Gtk 3. Якщо ви хочете вибрати певну версію
Gtk, скористайтеся командою \f(CW\*(C`./configure \-\-with\-gtk=2\*(C'\fR або
\&\f(CW\*(C`./configure \-\-with\-gtk=3\*(C'\fR.
.IP "D\-Bus" 4
.IX Item "D-Bus"
Необов'язкове.
.Sp
Якщо є доступним низькорівневий програмний інтерфейс D\-Bus мовою C, virt\-p2v
зможе надсилати повідомлення D\-Bus до logind для запобігання переходу у
режим заощадження енергії (присипляння або призупинення роботи) під час
перетворень P2V.
.Sp
Якщо цей програмний інтерфейс виявиться недоступним на момент збирання, дуже
довгі перетворення може бути перервано переходом фізичної машини у стан
присипляння.
.IP "zip" 4
.IX Item "zip"
.PD 0
.IP "unzip" 4
.IX Item "unzip"
.PD
Необов'язкове. Використовується virt\-v2v для обробки файлів \s-1OVA.\s0
.IP "python-evtx" 4
.IX Item "python-evtx"
Необов'язкове. Використовується \fBvirt\-log\fR\|(1) для обробки файлів журналу
подій Windows.
.IP "OCaml gettext" 4
.IX Item "OCaml gettext"
Необов'язкове. Для локалізації засобів віртуалізації OCaml.
.IP "ocaml-ounit ≥ 2.0.0" 4
.IX Item "ocaml-ounit ≥ 2.0.0"
Необов'язкове. Для тестування загальних модулів OCaml.
.IP "ocaml-libvirt ≥ 0.6.1.5" 4
.IX Item "ocaml-libvirt ≥ 0.6.1.5"
Необов'язковий. Для збирання необов'язкового комплексу для тестування
virt\-v2v.
.ie n .IP "Perl ""Module::Build"" ≥ 0.19" 4
.el .IP "Perl \f(CWModule::Build\fR ≥ 0.19" 4
.IX Item "Perl Module::Build ≥ 0.19"
.PD 0
.ie n .IP "Perl ""Test::More""" 4
.el .IP "Perl \f(CWTest::More\fR" 4
.IX Item "Perl Test::More"
.PD
Необов'язкове. Використовується для збирання і тестування прив'язок Perl.
.IP "Python ≥ 2.2" 4
.IX Item "Python ≥ 2.2"
Необов'язковий. Використовується для збирання прив'язок до Python. Опис
збирання прив'язок для Python 2 або Python 3 наведено у розділі \*(L"ЗБИРАННЯ
ПРИВ'ЯЗОК ДО \s-1PYTHON 2\s0 І \s-1PYTHON 3\*(R"\s0 нижче.
.ie n .IP "Python ""unittest""" 4
.el .IP "Python \f(CWunittest\fR" 4
.IX Item "Python unittest"
Необов'язкове. Використовується для запуску комплексу тестування Python.
.IP "Ruby" 4
.IX Item "Ruby"
.PD 0
.IP "rake" 4
.IX Item "rake"
.IP "rubygem-minitest" 4
.IX Item "rubygem-minitest"
.IP "rubygem-rdoc" 4
.IX Item "rubygem-rdoc"
.PD
Необов’язкове. Використовується для збирання прив’язок до Ruby.
.IP "Java ≥ 1.6" 4
.IX Item "Java ≥ 1.6"
Необов'язковий. Для збирання прив'язок до Java потрібні пакунки Java, \s-1JNI\s0 та
jpackage-utils.
.IP "\s-1GHC\s0" 4
.IX Item "GHC"
Необов’язкове. Використовується для збирання прив’язок до Haskell.
.IP "\s-1PHP\s0" 4
.IX Item "PHP"
.PD 0
.IP "phpize" 4
.IX Item "phpize"
.PD
Необов’язкове. Використовується для збирання прив’язок до \s-1PHP.\s0
.IP "glib2" 4
.IX Item "glib2"
.PD 0
.IP "gobject-introspection" 4
.IX Item "gobject-introspection"
.IP "gjs" 4
.IX Item "gjs"
.PD
Необов'язкове. Використовується для збирання і тестування прив'язок GObject.
.IP "\s-1LUA\s0" 4
.IX Item "LUA"
Необов’язкове. Використовується для збирання прив’язок до \s-1LUA.\s0
.IP "Erlang" 4
.IX Item "Erlang"
.PD 0
.IP "erl_interface" 4
.IX Item "erl_interface"
.PD
Необов’язкове. Використовується для збирання прив’язок до Erlang.
.IP "golang ≥ 1.1.1" 4
.IX Item "golang ≥ 1.1.1"
Необов’язкове. Використовується для збирання прив’язок до Go.
.IP "valgrind" 4
.IX Item "valgrind"
Необов’язкове. Використовується для діагностування проблем із пам’яттю.
.ie n .IP "Perl ""Sys::Virt""" 4
.el .IP "Perl \f(CWSys::Virt\fR" 4
.IX Item "Perl Sys::Virt"
Необов'язкове.
.IP "libvirt-python" 4
.IX Item "libvirt-python"
Обов'язковий. Для тестування взаємодії libvirt/libguestfs з Python.
.ie n .IP "Perl ""Win::Hivex""" 4
.el .IP "Perl \f(CWWin::Hivex\fR" 4
.IX Item "Perl Win::Hivex"
Необов'язкове. Використовується програмою \fBvirt\-win\-reg\fR\|(1).
.ie n .IP "Perl ""Pod::Usage""" 4
.el .IP "Perl \f(CWPod::Usage\fR" 4
.IX Item "Perl Pod::Usage"
Необов'язкове. Використовується деякими інструментами віртуалізації Perl.
.ie n .IP "Perl ""libintl""" 4
.el .IP "Perl \f(CWlibintl\fR" 4
.IX Item "Perl libintl"
Необов'язкове.
.IP "bash-completion" 4
.IX Item "bash-completion"
Необов'язкове. Для доповнення команд у відповідь на натискання Tab у bash.
.IP "libtsk" 4
.IX Item "libtsk"
Необов'язкове. Бібліотека для докладного аналізу файлових систем.
.IP "yara" 4
.IX Item "yara"
Необов'язкове. Для категоризації файлів на основі вмісту.
.SH "ЗБИРАННЯ ІЗ GIT"
.IX Header "ЗБИРАННЯ ІЗ GIT"
Для збирання з git вам знадобляться додаткові залежності — \f(CW\*(C`autoconf\*(C'\fR,
\&\f(CW\*(C`automake\*(C'\fR, \f(CW\*(C`gettext\*(C'\fR, findlib з OCaml та po4a.
.PP
.Vb 4
\& git clone https://github.com/libguestfs/libguestfs
\& cd libguestfs
\& ./autogen.sh
\& make
.Ve
.SH "ЗБИРАННЯ ІЗ АРХІВІВ TAR"
.IX Header "ЗБИРАННЯ ІЗ АРХІВІВ TAR"
Архіви tar отримуються з http://download.libguestfs.org/.  Stable
tarballs are signed with the GnuPG key for \f(CW\*(C`rich@annexia.org\*(C'\fR, see
https://pgp.mit.edu/pks/lookup?op=vindex&search=0x91738F73E1B768A0.
Відбиток — \f(CW\*(C`F777 4FB1 AD07 4A7E 8C87 67EA 9173 8F73 E1B7 68A0\*(C'\fR.
.PP
Отримайте і розпакуйте архів.
.PP
.Vb 3
\& cd libguestfs\-1.xx.yy
\& ./configure
\& make
.Ve
.SH "ТЕСТУВАННЯ"
.IX Header "ТЕСТУВАННЯ"
\&\fBНЕ ВИКОНУЙТЕ тестування від імені користувача root!\fR Libguestfs можна
зібрати і перевірити без використання адміністративного облікового запису
(root). Запуск тестів від імені користувача root може бути небезпечним, не
робіть цього.
.PP
Для перевірки, чи працюватиме збирання, віддайте таку команду:
.PP
.Vb 1
\& make quickcheck
.Ve
.PP
Щоб запустити основні тести, віддайте таку команду:
.PP
.Vb 1
\& make check
.Ve
.PP
Існує доволі багато інших тестів, які ви можете запустити. Опис цих тестів
наведено у підручнику з \fBguestfs\-hacking\fR\|(1).
.SH "ВСТАНОВЛЕННЯ"
.IX Header "ВСТАНОВЛЕННЯ"
\&\fBНЕ КОРИСТУЙТЕСЯ командою \f(CB\*(C`make install\*(C'\fB!\fR Її використання призведе до
конфлікту встановлених версій libguestfs, а це ускладнить роботу
користувачів. Замість використання цієї команди, ознайомтеся із описом
використання \fI./run\fR, наведеним у наступному розділі.
.PP
Пакувальники дистрибутивів можуть скористатися ось цим:
.PP
.Vb 1
\& make INSTALLDIRS=vendor DESTDIR=[temp\-build\-dir] install
.Ve
.SH "СКРИПТ ./run"
.IX Header "СКРИПТ ./run"
Ви можете запускати \fBguestfish\fR\|(1), \fBguestmount\fR\|(1) та інші інструменти
віртуалізації без їхнього встановлення за допомогою скрипту \fI./run\fR у
кореневому каталозі розпакованого коду. Цей скрипт працює, встановлюючи
декілька змінних середовища.
.PP
Приклад:
.PP
.Vb 1
\& ./run guestfish [звичайні аргументи guestfish ...]
\&
\& ./run virt\-inspector [звичайні аргументи virt\-inspector ...]
.Ve
.PP
Скрипт \fI./run\fR додає усі виконувані файли libguestfs до \f(CW$PATH\fR, отже у
наведених вище прикладах guestfish і virt-inspector запускаються із каталогу
збирання (не із загального каталогу встановленого guestfish, якщо такий
існує).
.PP
Ви можете скористатися скриптом з будь\-якого каталогу. Якщо вам потрібно
запустити вашу програму, яка використовує libguestfs, має спрацювати така
команда:
.PP
.Vb 1
\& /шлях/до/libguestfs/run ./ваша_програма [...]
.Ve
.PP
Також можна запускати програми C під керуванням valgrind ось так:
.PP
.Vb 1
\& ./run valgrind [параметри valgrind...] virt\-cat [параметри virt\-cat...]
.Ve
.PP
або у gdb:
.PP
.Vb 1
\& ./run gdb \-\-аргументи virt\-cat [параметри virt\-cat...]
.Ve
.PP
Це також працює із sudo (наприклад, якщо вам потрібен адміністративний
доступ для libvirt або для доступу до блокового пристрою):
.PP
.Vb 1
\& sudo ./run virt\-cat \-d LinuxGuest /etc/passwd
.Ve
.PP
Для встановлення значення змінних середовища ви можете скористатися або цим:
.PP
.Vb 1
\& LIBGUESTFS_HV=/my/qemu ./run guestfish
.Ve
.PP
або:
.PP
.Vb 1
\& ./run env LIBGUESTFS_HV=/my/qemu guestfish
.Ve
.SH "ФАЙЛИ \fIlocal*\fP"
.IX Header "ФАЙЛИ local*"
Файли у кореневому каталозі коду, назви яких починаються з префікса
\&\fIlocal*\fR, буде проігноровано git. Ці файли можуть містити локальні
налаштування або скрипти, які потрібні для збирання libguestfs.
.PP
Можна створити файл із назвою \fIlocalconfigure\fR, який буде простою обгорткою
\&\fIautogen.sh\fR, яка міститиме локальні зміни у налаштуваннях. Його вміст
виглядатиме так:
.PP
.Vb 5
\& . localenv
\& ./autogen.sh \e
\&     \-C \e
\&     \-\-enable\-werror \e
\&     "$@"
.Ve
.PP
Далі, ви зможете скористатися цим файлом для збирання libguestfs:
.PP
.Vb 1
\& ./localconfigure && make
.Ve
.PP
Якщо у кореневому каталозі збирання буде файл із назвою \fIlocalenv\fR, \f(CW\*(C`make\*(C'\fR
обробить його вміст. У цьому файлі можуть міститися усі потрібні змінні
середовища, наприклад змінні для пропускання тестів:
.PP
.Vb 4
\& # Використовувати інший інтерпретатор python.
\& export PYTHON=python3
\& # Пропустити цю перевірку, вона не працює.
\& export SKIP_TEST_BTRFS_FSCK=1
.Ve
.PP
Зауважте, що \fIlocalenv\fR включається до Makefile верхнього рівня (стає
частиною Makefile). Але, якщо цей файл обробляється також вашим скриптом
\&\fIlocalconfigure\fR, його буде використано як скрипт оболонки.
.SH "ВИБРАНІ ПАРАМЕТРИ ./configure"
.IX Header "ВИБРАНІ ПАРАМЕТРИ ./configure"
Для скрипту \f(CW\*(C`./configure\*(C'\fR передбачено багато параметрів. Зокрема, команда
.PP
.Vb 1
\& ./configure \-\-help
.Ve
.PP
показує список усіх цих параметрів. У цьому розділі наведено лише
найважливіші з них.
.IP "\fB\-\-disable\-appliance \-\-disable\-daemon\fR" 4
.IX Item "--disable-appliance --disable-daemon"
Див. \*(L"ВИКОРИСТАННЯ ПОПЕРЕДНЬО ЗІБРАНОЇ БІНАРНОЇ ОСНОВНОЇ СИСТЕМИ\*(R" нижче.
.IP "\fB\-\-disable\-erlang\fR" 4
.IX Item "--disable-erlang"
.PD 0
.IP "\fB\-\-disable\-gobject\fR" 4
.IX Item "--disable-gobject"
.IP "\fB\-\-disable\-golang\fR" 4
.IX Item "--disable-golang"
.IP "\fB\-\-disable\-haskell\fR" 4
.IX Item "--disable-haskell"
.IP "\fB\-\-disable\-lua\fR" 4
.IX Item "--disable-lua"
.IP "\fB\-\-disable\-ocaml\fR" 4
.IX Item "--disable-ocaml"
.IP "\fB\-\-disable\-perl\fR" 4
.IX Item "--disable-perl"
.IP "\fB\-\-disable\-php\fR" 4
.IX Item "--disable-php"
.IP "\fB\-\-disable\-python\fR" 4
.IX Item "--disable-python"
.IP "\fB\-\-disable\-ruby\fR" 4
.IX Item "--disable-ruby"
.PD
Вимкнути вказані прив'язки до мов, навіть якщо \f(CW\*(C`./configure\*(C'\fR знайде усі
потрібні бібліотеки і ці прив'язки можна буде зібрати.
.Sp
Зауважте, що вимикання OCaml (прив'язок) або Perl призведе до того, що буде
вимкнено частину комплексу засобів тестування та деякі інструменти.
.Sp
Для збирання libguestfs необхідний OCaml. Цю залежність не можна
вилучити. Використання прапорця \fI\-\-disable\-ocaml\fR вимикає лише збирання
прив'язок та інструментів мовою OCaml.
.IP "\fB\-\-disable\-fuse\fR" 4
.IX Item "--disable-fuse"
Вимкнути підтримку \s-1FUSE\s0 у програмному інтерфейсі і програмі
\&\fBguestmount\fR\|(1).
.IP "\fB\-\-disable\-gnulib\-tests\fR" 4
.IX Item "--disable-gnulib-tests"
На деяких платформах працездатність комплексу тестування GNUlib перебуває
під сумнівом. За допомогою цього прапорця можна вимкнути комплекс
тестування, оскільки помилки, на які вказує GNUlib, часто є несуттєвими.
.IP "\fB\-\-disable\-static\fR" 4
.IX Item "--disable-static"
Не збирати версії бібліотеки libguestfs зі статичною прив'язкою.
.IP "\fB\-\-enable\-install\-daemon\fR" 4
.IX Item "--enable-install-daemon"
Зазвичай, \fBguestfsd\fR\|(8) не встановлюється \f(CW\*(C`make install\*(C'\fR, оскільки ця
фонова служба у основній системі непотрібна (вона корисна, лише коли її
«встановлено» у базовій системі supermin). Втім, якщо пакувальники збирають
«портативну версію libguestfs», їм слід скористатися цим параметром.
.IP "\fB\-\-enable\-werror\fR" 4
.IX Item "--enable-werror"
За допомогою цього параметра можна перетворити попередження на помилки
(тобто додати \f(CW\*(C`\-Werror\*(C'\fR). Скористайтеся цим параметром для розробки,
особливо, якщо надсилатимете латки. Загалом, цей параметр \fIне\fR слід
використовувати для робочих або дистрибутивних збірок.
.IP "\fB\-\-with\-default\-backend=libvirt\fR" 4
.IX Item "--with-default-backend=libvirt"
Визначає типовий спосіб, у який libguestfs запускає qemu
(див. \*(L"МОДУЛЬ\*(R" in \fBguestfs\fR\|(3)). Якщо не вказано, типовим модулем буде
\&\f(CW\*(C`direct\*(C'\fR, що означає, що libguestfs запускатиме qemu безпосередньо.
.Sp
У Fedora і Red Hat Enterprise Linux (\s-1RHEL\s0) ≥ 7 цим прапорцем можна
скористатися для зміни типового модуля обробки на \f(CW\*(C`libvirt\*(C'\fR, оскільки
(особливо у \s-1RHEL\s0) правила безпеки забороняють запуск qemu, інакше як за
допомогою libvirt.
.Sp
Зауважте, що незважаючи на цей параметр, у libguestfs збираються усі модулі
обробки, і ви можете перевизначити модуль обробки під час запуску програм
встановленням змінної середовища \f(CW$LIBGUESTFS_BACKEND\fR (або за допомогою
програмних інтерфейсів).
.IP "\fB\-\-with\-distro=REDHAT|DEBIAN|...\fR" 4
.IX Item "--with-distro=REDHAT|DEBIAN|..."
Libguestfs потребує відомостей, який дистрибутив Linux використовується, щоб
бібліотека могла вибрати назви пакунків базової системи належним чином
(див., наприклад, \fIappliance/packagelist.in\fR). Зазвичай, це завдання
виконується автоматично.
.Sp
Втім, якщо ви збираєте і пакуєте libguestfs у новому дистрибутиві, ви можете
скористатися \fI\-\-with\-distro\fR, щоб вказати, що дистрибутив є подібним до
наявного (наприклад, \fI\-\-with\-distro=REDHAT\fR, якщо дистрибутив є новою
похідною від Red Hat або CentOS).
.Sp
Зауважте, що якщо ваш дистрибутив є повністю новим, він може потребувати
внесення змін до основної гілки коду бібліотеки.
.ie n .IP "\fB\-\-with\-extra=""\fR\fIназва_дистрибутива\fR=\fIверсія\fR,libvirt,...\fB""\fR" 4
.el .IP "\fB\-\-with\-extra=``\fR\fIназва_дистрибутива\fR=\fIверсія\fR,libvirt,...\fB''\fR" 4
.IX Item "--with-extra=""назва_дистрибутива=версія,libvirt,..."""
.PD 0
.ie n .IP "\fB\-\-with\-extra=""local""\fR" 4
.el .IP "\fB\-\-with\-extra=``local''\fR" 4
.IX Item "--with-extra=local"
.PD
Цей параметр визначає вміст поля «extra», яке повертає
\&\*(L"guestfs_version\*(R" in \fBguestfs\fR\|(3), а також виводиться параметром \fI\-\-version\fR
засобів віртуалізації. Вміст цього поля є довільним, втім, слід записати до
нього список відокремлених комами фактів, зокрема щодо назви і версії
бібліотеки, те, чи libvirt є типовим модулем обробки, і взагалі усе, що може
допомогти користувачам із діагностичними проблемами.
.Sp
Для нетипових і/або локальних збірок можете встановити для цього параметра
значення \f(CW\*(C`local\*(C'\fR, щоб позначити, що це \fIне\fR дистрибутивна збірка.
.IP "\fB\-\-without\-libvirt\fR" 4
.IX Item "--without-libvirt"
Зібрати libguestfs без підтримки libvirt, навіть якщо буде виявлено
встановлені бібліотеки для розробки libvirt.
.IP "\fB\-\-with\-gtk=2\fR" 4
.IX Item "--with-gtk=2"
Цей параметр примусово визначає для virt\-p2v збирання із Gtk 2, у
конфігурації, яка у поточній версії є найкраще перевіреною.
.ie n .IP "\fB\-\-with\-qemu=""\fRвиконуваний файл1 виконуваний файл2 ...\fB""\fR" 4
.el .IP "\fB\-\-with\-qemu=``\fRвиконуваний файл1 виконуваний файл2 ...\fB''\fR" 4
.IX Item "--with-qemu=""виконуваний файл1 виконуваний файл2 ..."""
Визначає альтернативний виконуваний файл qemu (або список виконуваних
файлів). Назву виконуваного файла можна змінити встановленням значення
змінної середовища \f(CW\*(C`LIBGUESTFS_HV\*(C'\fR.
.IP "\fB\-\-with\-supermin\-packager\-config=\fR\fIyum.conf\fR" 4
.IX Item "--with-supermin-packager-config=yum.conf"
Передає параметр \fI\-\-packager\-config\fR до \fBsupermin\fR\|(1).
.Sp
Найпоширенішим випадком використання цього параметра є збирання базової
системи за допомогою альтернативного сховища пакунків (замість використання
встановлених налаштувань yum, dnf, apt тощо для пошуку і отримання
пакунків). Можливо, вам захочеться скористатися цим, якщо ви захочете
зібрати libguestfs без використання з'єднання із мережею. Приклади
використання цього параметра можна знайти у файлі \f(CW\*(C`libguestfs.spec\*(C'\fR для
Fedora (див. \*(L"ЗБИРАННЯ ПАКУНКА ДЛЯ \s-1FEDORA\*(R"\s0 нижче, щоб дізнатися більше).
.ie n .IP "\fB\-\-with\-supermin\-extra\-options=""\fR\-\-парам1 \-\-парам2 ...\fB""\fR" 4
.el .IP "\fB\-\-with\-supermin\-extra\-options=``\fR\-\-парам1 \-\-парам2 ...\fB''\fR" 4
.IX Item "--with-supermin-extra-options=""--парам1 --парам2 ..."""
Передати додаткові параметри \fBsupermin\fR\|(1). Див. \fIappliance/make.sh.in\fR,
щоб зрозуміти, як саме це слід робити.
.IP "\fB\s-1PYTHON\s0\fR" 4
.IX Item "PYTHON"
Цією змінною середовища можна скористатися для того, щоб вказати виконуваний
файл python (наприклад, \f(CW\*(C`python3\*(C'\fR). Під час запуску \f(CW\*(C`./configure\*(C'\fR програма
виконує визначення версії цього виконуваного файла Python, розташування
бібліотек Python тощо. Див. \*(L"ЗБИРАННЯ ПРИВ'ЯЗОК ДО \s-1PYTHON 2\s0 І \s-1PYTHON 3\*(R"\s0
нижче.
.IP "\fB\s-1SUPERMIN\s0\fR" 4
.IX Item "SUPERMIN"
Цією змінною середовища можна скористатися для вибору альтернативного
виконуваного файла \fBsupermin\fR\|(1). Вона може пригодитися, якщо ви хочете
скористатися новішою версією supermin, ніж та, яка є частиною пакунків
вашого дистрибутива, або якщо у вашому дистрибутиві взагалі немає пакунка
supermin. У \s-1RHEL 7\s0 вам слід встановити \f(CW\*(C`SUPERMIN=/usr/bin/supermin5\*(C'\fR під
час збирання libguestfs.
.SH "НОТАТКИ ЩОДО QEMU І KVM"
.IX Header "НОТАТКИ ЩОДО QEMU І KVM"
Типовою проблемою є помилкові або несумісні випуски qemu.
.PP
У різних версіях qemu можуть із різних причин виникати проблеми із
завантаженням базової системи. Проблеми залежать від версії qemu та
дистрибутивів Linux, які можуть накладати на код пакунка різні латки.
.PP
Якщо вами буде виявлено проблему, ви можете спробувати скористатися власним
зібраним із початкових кодів виконуваним файлом qemu (qemu дуже просто
зібрати із початкових кодів) за допомогою «обгортки
qemu». Див. \*(L"ОБГОРТКИ \s-1QEMU\*(R"\s0 in \fBguestfs\fR\|(3).
.PP
Типово, скрипт налаштовування шукатиме qemu-kvm (підтримку \s-1KVM\s0). \s-1KVM\s0 є
набагато швидшим за звичайний qemu.
.PP
Крім того, може виникнути потреба у вмиканні підтримки \s-1KVM\s0 для користувачів,
відмінних від root. Слід скористатися цими настановами:
http://www.linux\-kvm.org/page/FAQ#How_can_I_use_kvm_with_a_non\-privileged_user.3F
.PP
У деяких системах таке теж спрацює:
.PP
.Vb 1
\& chmod 0666 /dev/kvm
.Ve
.PP
У деяких системах, де зміна режиму доступу не переживає перезавантаження
системи, вам доведеться внести зміни до налаштувань udev.
.SH "ВИКОРИСТАННЯ CLANG (LLVM) ЗАМІСТЬ GCC"
.IX Header "ВИКОРИСТАННЯ CLANG (LLVM) ЗАМІСТЬ GCC"
.Vb 3
\& export CC=clang
\& ./configure
\& make
.Ve
.SH "ВИКОРИСТАННЯ ПОПЕРЕДНЬО ЗІБРАНОЇ БІНАРНОЇ ОСНОВНОЇ СИСТЕМИ"
.IX Header "ВИКОРИСТАННЯ ПОПЕРЕДНЬО ЗІБРАНОЇ БІНАРНОЇ ОСНОВНОЇ СИСТЕМИ"
Щоб зрозуміти, що таке базова система libguestfs,
див. \fBguestfs\-internals\fR\|(1).
.PP
Якщо ви користуєтеся операційною системою, відмінною від Linux, або
дистрибутивом Linux, у якому немає пакунка \fBsupermin\fR\|(1), або просто не
хочете збирати власну базову систему libguestfs, ви можете скористатися
попередньо зібраними двійковими базовими системами, які ми постачаємо:
http://libguestfs.org/download/binaries/appliance
.PP
Зберіть libguestfs ось таким чином:
.PP
.Vb 2
\& ./configure \-\-disable\-appliance \-\-disable\-daemon
\& make
.Ve
.PP
Встановіть для змінної \f(CW$LIBGUESTFS_PATH\fR значення шляху, до якого ви
розпакували архів tar із базовою системою, ось так:
.PP
.Vb 1
\& export LIBGUESTFS_PATH=/usr/local/lib/guestfs/appliance
.Ve
.PP
і запускайте програми libguestfs та засоби віртуалізації у звичайний спосіб,
наприклад, за допомогою скрипту \fI./run\fR (див. вище).
.SH "ЗБИРАННЯ ПРИВ’ЯЗОК ДО PYTHON 2 І PYTHON 3"
.IX Header "ЗБИРАННЯ ПРИВ’ЯЗОК ДО PYTHON 2 І PYTHON 3"
Скрипт \fI./configure\fR визначає поточну встановлену версію Python на основі
даних будь\-якої програми, яка називається \f(CW\*(C`python\*(C'\fR і зберігається у одному
з каталогів, описаних у змінній \f(CW$PATH\fR. Libguestfs збиратиме, відповідно,
прив'язки до Python 2 або до Python 3.
.PP
Ви можете перевизначити цю поведінку, якщо вкажете альтернативний
виконуваний файл Python. Приклад:
.PP
.Vb 1
\& PYTHON=/usr/bin/python3 ./configure
.Ve
.PP
Щоб зібрати одночасно прив'язки до Python 2 і Python 3, вам доведеться
збирати libguestfs двічі. Під час другого збирання ви можете вимкнути усі
інші прив'язки та інструменти і зібрати лише прив'язки до Python. Із повним
прикладом того, як це зробити, можна ознайомитися за допомогою файла spec з
Fedora (див. нижче).
.SH "ЗБИРАННЯ ПАКУНКА ДЛЯ FEDORA"
.IX Header "ЗБИРАННЯ ПАКУНКА ДЛЯ FEDORA"
Файл spec для Fedora зберігається тут:
http://pkgs.fedoraproject.org/cgit/rpms/libguestfs.git/
.PP
Libguestfs зібрано у Fedora за допомогою типової системи збирання Fedora
(Koji).
.SH "ЗБИРАННЯ ПАКУНКА ДЛЯ RED HAT ENTERPRISE LINUX"
.IX Header "ЗБИРАННЯ ПАКУНКА ДЛЯ RED HAT ENTERPRISE LINUX"
Збірки libguestfs для Red Hat Enterprise Linux (\s-1RHEL\s0) містять дуже багато
латок. Загалом, ці латки можна поділити на два типи:
.IP "\(bu" 4
Вимикання багатьох можливостей, підтримку яких ми не хочемо здійснювати для
користувачів \s-1RHEL.\s0 Наприклад, ми вимикаємо підтримку можливості «libguestfs
live».
.IP "\(bu" 4
Ми виконуємо зворотне портування можливостей основної версії.
.PP
Латки, які ми застосовуємо для випусків \s-1RHEL\s0 загально доступні у нашому
основному сховищі коду git, гілка називається \f(CW\*(C`rhel\-x.y\*(C'\fR
.PP
Наприклад, із латками для \s-1RHEL 7.3\s0 можна ознайомитися тут:
https://github.com/libguestfs/libguestfs/commits/rhel\-7.3
.PP
Початкові коди і файли spec для версії libguestfs для \s-1RHEL\s0 можна знайти на
сторінці https://git.centos.org/project/rpms. Також варто ознайомитися із
вмістом сторінки https://wiki.centos.org/Sources.
.SH "ЗБИРАННЯ VIRT\-P2V ДЛЯ 32\-БІТОВОЇ АРХІТЕКТУРИ i686"
.IX Header "ЗБИРАННЯ VIRT-P2V ДЛЯ 32-БІТОВОЇ АРХІТЕКТУРИ i686"
\&\fI(Цей розділ стосується лише архітектури x86\-64.)\fR
.PP
Збирання 32\-бітової версії виконуваного файла virt\-p2v (i686) покращує
сумісність із застарілим обладнанням. Докладніший опис наведено у підручнику
з \fBvirt\-p2v\-make\-disk\fR\|(1). Хоча virt\-p2v є простою програмою на основі Gtk,
зібрати 32\-бітову версію програми virt\-p2v на 64\-бітовій основній системі
доволі непросто. Зазвичай, найпростішим способом є використання 32\-бітової
пісочниці chroot або навіть 32\-бітової віртуальної машини для збирання
libguestfs.
.PP
У Fedora ви можете скористатися інструментом \fBmock\fR\|(1). Приклад:
.PP
.Vb 1
\& fedpkg mockbuild \-\-root fedora\-23\-i386
.Ve
.PP
У результаті буде створено файл \fIvirt\-v2v\-*.i686.rpm\fR, який можна
розпакувати для видобування 32\-бітового виконуваного файла virt\-p2v.
.PP
Виконуваний файл може бути стиснуто у \fIp2v/virt\-p2v.i686.xz\fR,
\&\fI\f(CI$libdir\fI/virt\-p2v/virt\-p2v.i686.xz\fR або
\&\fI\f(CI$VIRT_P2V_DATA_DIR\fI/virt\-p2v.i686.xz\fR. Це вмикає параметр  \fI\-\-arch\fR
\&\fBvirt\-p2v\-make\-disk\fR\|(1).
.SH "ТАКОЖ ПЕРЕГЛЯНЬТЕ"
.IX Header "ТАКОЖ ПЕРЕГЛЯНЬТЕ"
\&\fBguestfs\fR\|(3), \fBguestfs\-examples\fR\|(3), \fBguestfs\-hacking\fR\|(1),
\&\fBguestfs\-internals\fR\|(1), \fBguestfs\-performance\fR\|(1),
\&\fBguestfs\-release\-notes\fR\|(1), \fBguestfs\-testing\fR\|(1),
\&\fBlibguestfs\-test\-tool\fR\|(1), \fBlibguestfs\-make\-fixed\-appliance\fR\|(1),
http://libguestfs.org/.
.SH "АВТОРИ"
.IX Header "АВТОРИ"
Richard W.M. Jones (\f(CW\*(C`rjones at redhat dot com\*(C'\fR)
.SH "АВТОРСЬКІ ПРАВА"
.IX Header "АВТОРСЬКІ ПРАВА"
Copyright (C) 2009\-2019 Red Hat Inc.
.SH "LICENSE"
.IX Header "LICENSE"
.SH "BUGS"
.IX Header "BUGS"
To get a list of bugs against libguestfs, use this link:
https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&product=Virtualization+Tools
.PP
To report a new bug against libguestfs, use this link:
https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&product=Virtualization+Tools
.PP
When reporting a bug, please supply:
.IP "\(bu" 4
The version of libguestfs.
.IP "\(bu" 4
Where you got libguestfs (eg. which Linux distro, compiled from source, etc)
.IP "\(bu" 4
Describe the bug accurately and give a way to reproduce it.
.IP "\(bu" 4
Run \fBlibguestfs\-test\-tool\fR\|(1) and paste the \fBcomplete, unedited\fR
output into the bug report.
