.\" Automatically generated by Podwrapper::Man 1.21.34 (Pod::Simple 3.20)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\" ========================================================================
.\"
.IX Title "virt-sysprep 1"
.TH virt-sysprep 1 "2013-04-25" "libguestfs-1.21.34" "Virtualization Support"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "НАЗВА"
.IX Header "НАЗВА"
virt-sysprep \- Reset, unconfigure or customize a virtual machine so clones
can be made
.SH "КОРОТКИЙ ОПИС"
.IX Header "КОРОТКИЙ ОПИС"
.Vb 1
\& virt\-sysprep [\-\-параметри] \-d назва_домену
\&
\& virt\-sysprep [\-\-options] \-a disk.img [\-a disk.img ...]
.Ve
.SH "ОПИС"
.IX Header "ОПИС"
Virt-sysprep can reset or unconfigure a virtual machine so that clones can
be made from it.  Steps in this process include removing \s-1SSH\s0 host keys,
removing persistent network \s-1MAC\s0 configuration, and removing user accounts.
Virt-sysprep can also customize a virtual machine, for instance by adding
\&\s-1SSH\s0 keys, users or logos.  Each step can be enabled or disabled as required.
.PP
Virt-sysprep modifies the guest or disk image \fIin place\fR.  The guest must
be shut down.  If you want to preserve the existing contents of the guest,
\&\fIyou must snapshot, copy or clone the disk first\fR.  See \*(L"\s-1COPYING\s0 \s-1AND\s0
\&\s-1CLONING\s0\*(R" below.
.PP
You do \fInot\fR need to run virt-sysprep as root.  In fact we'd generally
recommend that you don't.  The time you might want to run it as root is when
you need root in order to access the disk image, but even in this case it
would be better to change the permissions on the disk image to be writable
as the non-root user running virt-sysprep.
.PP
\&\*(L"Sysprep\*(R" stands for \*(L"system preparation\*(R" tool.  The name comes from the
Microsoft program \f(CW\*(C`sysprep.exe\*(C'\fR which is used to unconfigure Windows
machines in preparation for cloning them.  Having said that, virt-sysprep
does \fInot\fR currently work on Microsoft Windows guests.  We plan to support
Windows sysprepping in a future version, and we already have code to do it.
.SH "ПАРАМЕТРИ"
.IX Header "ПАРАМЕТРИ"
.IP "\fB\-\-help\fR" 4
.IX Item "--help"
Показати коротку довідку.
.IP "\fB\-a\fR файл" 4
.IX Item "-a файл"
.PD 0
.IP "\fB\-\-add\fR файл" 4
.IX Item "--add файл"
.PD
Додати \fIфайл\fR, який має бути образом диска з віртуальної машини.
.Sp
Формат образу диска визначається автоматично. Щоб перевизначити його і
примусово використати певний формат, скористайтеся параметром \fI\-\-format\fR.
.IP "\fB\-c\fR адреса" 4
.IX Item "-c адреса"
.PD 0
.IP "\fB\-\-connect\fR адреса" 4
.IX Item "--connect адреса"
.PD
Якщо використовується libvirt, встановити з’єднання з вказаним \fI\s-1URI\s0\fR. Якщо
пропущено, з’єднання буде встановлено з типовим гіпервізором libvirt.
.Sp
Якщо вказати блокові пристрої гостьових систем безпосередньо (\fI\-a\fR),
libvirt не буде використовуватися взагалі.
.IP "\fB\-d\fR гість" 4
.IX Item "-d гість"
.PD 0
.IP "\fB\-\-domain\fR гість" 4
.IX Item "--domain гість"
.PD
Додати всі диски з вказаної гостьової системи libvirt. \s-1UUID\s0 доменів можна
використовувати замість назв.
.IP "\fB\-n\fR" 4
.IX Item "-n"
.PD 0
.IP "\fB\-\-dry\-run\fR" 4
.IX Item "--dry-run"
.PD
Perform a read-only \*(L"dry run\*(R" on the guest.  This runs the sysprep
operation, but throws away any changes to the disk at the end.
.IP "\fB\-\-enable\fR operations" 4
.IX Item "--enable operations"
Choose which sysprep operations to perform.  Give a comma-separated list of
operations, for example:
.Sp
.Vb 1
\& \-\-enable ssh\-hostkeys,udev\-persistent\-net
.Ve
.Sp
would enable \s-1ONLY\s0 \f(CW\*(C`ssh\-hostkeys\*(C'\fR and \f(CW\*(C`udev\-persistent\-net\*(C'\fR operations.
.Sp
If the \fI\-\-enable\fR option is not given, then we default to trying most
sysprep operations (see \fI\-\-list\-operations\fR to show which are enabled).
.Sp
Regardless of the \fI\-\-enable\fR option, sysprep operations are skipped for
some guest types.
.Sp
Use \fI\-\-list\-operations\fR to list operations supported by a particular
version of virt-sysprep.
.Sp
See \*(L"\s-1OPERATIONS\s0\*(R" below for a list and an explanation of each operation.
.IP "\fB\-\-format\fR raw|qcow2|.." 4
.IX Item "--format raw|qcow2|.."
.PD 0
.IP "\fB\-\-format\fR auto" 4
.IX Item "--format auto"
.PD
The default for the \fI\-a\fR option is to auto-detect the format of the disk
image.  Using this forces the disk format for \fI\-a\fR options which follow on
the command line.  Using \fI\-\-format auto\fR switches back to auto-detection
for subsequent \fI\-a\fR options.
.Sp
Приклад:
.Sp
.Vb 1
\& virt\-sysprep \-\-format raw \-a disk.img
.Ve
.Sp
примусове встановлення формату без обробки (без автоматичного визначення)
для \f(CW\*(C`disk.img\*(C'\fR.
.Sp
.Vb 1
\& virt\-sysprep \-\-format raw \-a disk.img \-\-format auto \-a another.img
.Ve
.Sp
примусове встановлення формату без обробки (без автоматичного визначення)
для \f(CW\*(C`disk.img\*(C'\fR і повернення до автоматичного визначення для \f(CW\*(C`another.img\*(C'\fR.
.Sp
If you have untrusted raw-format guest disk images, you should use this
option to specify the disk format.  This avoids a possible security problem
with malicious guests (\s-1CVE\-2010\-3851\s0).
.IP "\fB\-\-list\-operations\fR" 4
.IX Item "--list-operations"
List the operations supported by the virt-sysprep program.
.Sp
These are listed one per line, with one or more single-space-separated
fields, eg:
.Sp
.Vb 6
\& $ virt\-sysprep \-\-list\-operations
\& bash\-history * Remove the bash history in the guest
\& cron\-spool * Remove user at\-jobs and cron\-jobs
\& dhcp\-client\-state * Remove DHCP client leases
\& dhcp\-server\-state * Remove DHCP server leases
\& [etc]
.Ve
.Sp
The first field is the operation name, which can be supplied to
\&\fI\-\-enable\fR.  The second field is a \f(CW\*(C`*\*(C'\fR character if the operation is
enabled by default or blank if not.  Subsequent fields on the same line are
the description of the operation.
.Sp
Before libguestfs 1.17.33 only the first (operation name) field was shown
and all operations were enabled by default.
.IP "\fB\-q\fR" 4
.IX Item "-q"
.PD 0
.IP "\fB\-\-quiet\fR" 4
.IX Item "--quiet"
.PD
Не виводити повідомлень до журналу.
.Sp
To enable detailed logging of individual file operations, use \fI\-x\fR.
.IP "\fB\-\-selinux\-relabel\fR" 4
.IX Item "--selinux-relabel"
.PD 0
.IP "\fB\-\-no\-selinux\-relabel\fR" 4
.IX Item "--no-selinux-relabel"
.PD
\&\fI\-\-selinux\-relabel\fR forces SELinux relabelling next time the guest boots.
\&\fI\-\-no\-selinux\-relabel\fR disables relabelling.
.Sp
The default is to try to detect if SELinux relabelling is required.  See
\&\*(L"\s-1SELINUX\s0 \s-1RELABELLING\s0\*(R" below for more details.
.IP "\fB\-v\fR" 4
.IX Item "-v"
.PD 0
.IP "\fB\-\-verbose\fR" 4
.IX Item "--verbose"
.PD
Увімкнути докладний показ повідомлень з метою діагностики.
.IP "\fB\-V\fR" 4
.IX Item "-V"
.PD 0
.IP "\fB\-\-version\fR" 4
.IX Item "--version"
.PD
Показати дані щодо версії і завершити роботу.
.IP "\fB\-x\fR" 4
.IX Item "-x"
Увімкнути трасування викликів програмного інтерфейсу libguestfs.
.ie n .IP "\fB\-\-firstboot\fR firstboot (see ""firstboot"" below)" 4
.el .IP "\fB\-\-firstboot\fR firstboot (see \f(CWfirstboot\fR below)" 4
.IX Item "--firstboot firstboot (see firstboot below)"
Run script(s) once next time the guest boots.  You can supply the
\&\fI\-\-firstboot\fR option as many times as needed.
.ie n .IP "\fB\-\-hostname\fR hostname (see ""hostname"" below)" 4
.el .IP "\fB\-\-hostname\fR hostname (see \f(CWhostname\fR below)" 4
.IX Item "--hostname hostname (see hostname below)"
Змінити назву вузла. Якщо не вказано, використовувати типове
\&\f(CW\*(C`localhost.localdomain\*(C'\fR.
.ie n .IP "\fB\-\-script\fR script (see ""script"" below)" 4
.el .IP "\fB\-\-script\fR script (see \f(CWscript\fR below)" 4
.IX Item "--script script (see script below)"
Run the named \f(CW\*(C`script\*(C'\fR (a shell script or program) against the guest.  The
script can be any program on the host.  The script's current directory will
be the guest's root directory.
.Sp
\&\fBNote:\fR If the script is not on the \f(CW$PATH\fR, then you must give the full
absolute path to the script.
.ie n .IP "\fB\-\-scriptdir\fR scriptdir (see ""script"" below)" 4
.el .IP "\fB\-\-scriptdir\fR scriptdir (see \f(CWscript\fR below)" 4
.IX Item "--scriptdir scriptdir (see script below)"
Точку монтування (порожній каталог на вузлі), використану при виконанні дії
\&\f(CW\*(C`script\*(C'\fR, увімкнено і вказано використання одного або декількох скриптів за
допомогою \fI\-\-script\fR.
.Sp
\&\fBЗауваження:\fR \f(CW\*(C`scriptdir\*(C'\fR \fBмає\fR бути вказано повністю.
.Sp
Якщо \fI\-\-scriptdir\fR не вказано, буде створено тимчасову точку монтування
.SH "ДІЇ"
.IX Header "ДІЇ"
If the \fI\-\-enable\fR option is \fInot\fR given, then most sysprep operations are
enabled.
.PP
Use \f(CW\*(C`virt\-sysprep \-\-list\-operations\*(C'\fR to list all operations for your
virt-sysprep binary.  The ones which are enabled by default are marked with
a \f(CW\*(C`*\*(C'\fR character.  Regardless of the \fI\-\-enable\fR option, sysprep operations
are skipped for some guest types.
.PP
Operations can be individually enabled using the \fI\-\-enable\fR option.  Use a
comma-separated list, for example:
.PP
.Vb 1
\& virt\-sysprep \-\-enable=ssh\-hostkeys,udev\-persistent\-net [тощо]
.Ve
.PP
Future versions of virt-sysprep may add more operations.  If you are using
virt-sysprep and want predictable behaviour, specify only the operations
that you want to have enabled.
.PP
\&\f(CW\*(C`*\*(C'\fR = enabled by default when no \fI\-\-enable\fR option is given.
.SS "\fBabrt-data\fP *"
.IX Subsection "abrt-data *"
Вилучити дані щодо аварії, створені \s-1ABRT\s0.
.PP
Remove the automatically generated \s-1ABRT\s0 crash data in \f(CW\*(C`/var/spool/abrt/\*(C'\fR.
.SS "\fBbash-history\fP *"
.IX Subsection "bash-history *"
Вилучити журнал команд bash у гостьовій системі.
.PP
Вилучити журнал команд bash користувача «root» та всіх інших користувачів, у
домашніх каталогах яких містяться файли \f(CW\*(C`.bash_history\*(C'\fR.
.SS "\fBblkid-tab\fP *"
.IX Subsection "blkid-tab *"
Вилучити вкладку ідентифікаторів блоків у гостьовій системі.
.SS "\fBca-certificates\fP"
.IX Subsection "ca-certificates"
Вилучити сертифікати \s-1CA\s0 у гостьовій системі.
.SS "\fBcrash-data\fP *"
.IX Subsection "crash-data *"
Remove the crash data generated by kexec-tools.
.PP
Remove the automatically generated kdump kernel crash data.
.SS "\fBcron-spool\fP *"
.IX Subsection "cron-spool *"
Вилучити завдання at та cron користувачів.
.SS "\fBdhcp-client-state\fP *"
.IX Subsection "dhcp-client-state *"
Вилучити надані клієнтські адреси \s-1DHCP\s0.
.SS "\fBdhcp-server-state\fP *"
.IX Subsection "dhcp-server-state *"
Вилучити надані серверні адреси \s-1DHCP\s0.
.SS "\fBdovecot-data\fP *"
.IX Subsection "dovecot-data *"
Вилучити дані Dovecot (поштового сервера).
.SS "\fBfirstboot\fP *"
.IX Subsection "firstboot *"
Додати скрипти для одноразового запуску під час наступного завантаження.
.PP
Supply one of more shell scripts (using the \fI\-\-firstboot\fR option).
.PP
These are run the first time the guest boots, and then are deleted.  So
these are useful for performing last minute configuration that must run in
the context of the guest operating system, for example \f(CW\*(C`yum update\*(C'\fR.
.PP
Output or errors from the scripts are written to
\&\f(CW\*(C`~root/virt\-sysprep\-firstboot.log\*(C'\fR (in the guest).
.PP
Currently this is only implemented for Linux guests using either System V
init, or systemd.
.SS "\fBflag-reconfiguration\fP"
.IX Subsection "flag-reconfiguration"
Позначити систему для зміни налаштувань.
.PP
Зауважте, що це може потребувати втручання користувача під час завантаження
гостьової системи.
.SS "\fBhostname\fP *"
.IX Subsection "hostname *"
Змінити назву вузла гостьової системи.
.PP
Ця дія змінює назву вузла гостьової системи на значення, вказане
за допомогою параметра \fI\-\-hostname\fR.
.PP
Якщо параметр \fI\-\-hostname\fR не буде вказано, назву вузла буде змінено на
\&\f(CW\*(C`localhost.localdomain\*(C'\fR.
.SS "\fBдані\-kerberos\fP"
.IX Subsection "дані-kerberos"
Вилучити дані Kerberos у гостьовій системі.
.SS "\fBlogfiles\fP *"
.IX Subsection "logfiles *"
Вилучити з гостьової системи багато файлів журналів.
.PP
У Linux вилучено такі файли:
.PP
.Vb 10
\& /root/anaconda\-ks.cfg
\& /root/install.log
\& /root/install.log.syslog
\& /var/cache/fontconfig/*
\& /var/cache/gdm/*
\& /var/cache/man/*
\& /var/lib/AccountService/users/*
\& /var/lib/fprint/*
\& /var/lib/logrotate.status
\& /var/log/*.log*
\& /var/log/BackupPC/LOG
\& /var/log/apache2/*_log
\& /var/log/apache2/*_log\-*
\& /var/log/audit/*
\& /var/log/audit/audit.log
\& /var/log/btmp*
\& /var/log/ceph/*.log
\& /var/log/chrony/*.log
\& /var/log/cron*
\& /var/log/cups/*_log
\& /var/log/dmesg*
\& /var/log/glusterfs/*glusterd.vol.log
\& /var/log/glusterfs/glusterfs.log
\& /var/log/httpd/*log
\& /var/log/jetty/jetty\-console.log
\& /var/log/lastlog*
\& /var/log/libvirt/libvirtd.log
\& /var/log/libvirt/lxc/*.log
\& /var/log/libvirt/qemu/*.log
\& /var/log/libvirt/uml/*.log
\& /var/log/mail/*
\& /var/log/maillog*
\& /var/log/messages*
\& /var/log/ntp
\& /var/log/ppp/connect\-errors
\& /var/log/secure*
\& /var/log/setroubleshoot/*.log
\& /var/log/spooler*
\& /var/log/squid/*.log
\& /var/log/tallylog*
\& /var/log/wtmp*
\& /var/named/data/named.run
.Ve
.SS "\fBlvm-uuids\fP *"
.IX Subsection "lvm-uuids *"
Змінити \s-1UUID\s0 ФТ і ГТ \s-1LVM2\s0.
.PP
On Linux guests that have \s-1LVM2\s0 physical volumes (PVs) or volume groups
(VGs), new random UUIDs are generated and assigned to those PVs and VGs.
.SS "\fBід\-комп’ютера\fP *"
.IX Subsection "ід-комп’ютера *"
Вилучити ідентифікатор локального комп’ютера.
.PP
The machine \s-1ID\s0 is usually generated from a random source during system
installation and stays constant for all subsequent boots.  Optionally, for
stateless systems it is generated during runtime at boot if it is found to
be empty.
.SS "\fBmail-spool\fP *"
.IX Subsection "mail-spool *"
Вилучити поштове повідомлення з локального каталогу поштового буфера.
.SS "\fBnet-hostname\fP *"
.IX Subsection "net-hostname *"
Вилучити \s-1HOSTNAME\s0 у налаштуваннях інтерфейсу мережі.
.PP
Для Fedora і Red Hat Enterprise Linux це вилучається з файлів \f(CW\*(C`ifcfg\-*\*(C'\fR.
.SS "\fBnet-hwaddr\fP *"
.IX Subsection "net-hwaddr *"
Вилучити налаштування \s-1HWADDR\s0 (апаратної адреси \s-1MAC\s0).
.PP
Для Fedora і Red Hat Enterprise Linux це вилучається з файлів \f(CW\*(C`ifcfg\-*\*(C'\fR.
.SS "\fBpacct-log\fP *"
.IX Subsection "pacct-log *"
Вилучити файли журналу обліку процесів.
.PP
The system wide process accounting will store to the pacct log files if the
process accounting is on.
.SS "\fBpackage-manager-cache\fP *"
.IX Subsection "package-manager-cache *"
Вилучити кеш керування пакунками.
.SS "\fBpam-data\fP *"
.IX Subsection "pam-data *"
Вилучити дані \s-1PAM\s0 у гостьовій системі.
.SS "\fBpuppet-data-log\fP *"
.IX Subsection "puppet-data-log *"
Вилучити дані та файли журналів puppet.
.SS "\fBrandom-seed\fP *"
.IX Subsection "random-seed *"
Створити породжувач випадкових чисел для гостьової системи.
.PP
Записати випадкові байти з основної системи до файла породжувача
псевдовипадкових чисел у гостьовій системі.
.PP
Див. \*(L"\s-1RANDOM\s0 \s-1SEED\s0\*(R" нижче.
.SS "\fBrhn-systemid\fP *"
.IX Subsection "rhn-systemid *"
Вилучити ідентифікатор системи у \s-1RHN\s0.
.SS "\fBsamba-db-log\fP *"
.IX Subsection "samba-db-log *"
Вилучити бази даних та файли журналів Samba.
.SS "\fBscript\fP *"
.IX Subsection "script *"
Запустити довільні скрипти дій над гостьовою системою.
.PP
The \f(CW\*(C`script\*(C'\fR module lets you run arbitrary shell scripts or programs
against the guest.
.PP
Note this feature requires \s-1FUSE\s0 support.  You may have to enable this in
your host, for example by adding the current user to the \f(CW\*(C`fuse\*(C'\fR group, or
by loading a kernel module.
.PP
Use one or more \fI\-\-script\fR parameters to specify scripts or programs that
will be run against the guest.
.PP
The script or program is run with its current directory being the guest's
root directory, so relative paths should be used.  For example: \f(CW\*(C`rm
etc/resolv.conf\*(C'\fR in the script would remove a Linux guest's \s-1DNS\s0
configuration file, but \f(CW\*(C`rm /etc/resolv.conf\*(C'\fR would (try to) remove the
host's file.
.PP
Normally a temporary mount point for the guest is used, but you can choose a
specific one by using the \fI\-\-scriptdir\fR parameter.
.PP
\&\fBNote:\fR This is different from \fI\-\-firstboot\fR scripts (which run in the
context of the guest when it is booting first time).  \fI\-\-script\fR scripts
run on the host, not in the guest.
.SS "\fBsmolt-uuid\fP *"
.IX Subsection "smolt-uuid *"
Вилучити \s-1UUID\s0 обладнання Smolt.
.SS "\fBssh-hostkeys\fP *"
.IX Subsection "ssh-hostkeys *"
Вилучити ключі вузла \s-1SSH\s0 у гостьовій системі.
.PP
Ключі вузла \s-1SSH\s0 повторно створюються (незалежно) під час наступного
завантаження гостьової системи.
.PP
Якщо після клонування гостьова система отримати ту саму IP\-адресу, ssh
надасть вам додаткове попередження щодо зміни ключа вузла:
.PP
.Vb 4
\& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
\& @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
\& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
\& IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
.Ve
.SS "\fBssh-userdir\fP *"
.IX Subsection "ssh-userdir *"
Вилучити каталоги «.ssh» у гостьовій системі.
.PP
Вилучити каталог \f(CW\*(C`.ssh\*(C'\fR користувача «root» та всіх інших користувачів,
домашні каталоги яких містять каталог \f(CW\*(C`.ssh\*(C'\fR.
.SS "\fBsssd-db-log\fP *"
.IX Subsection "sssd-db-log *"
Вилучити бази даних і файли журналів sssd.
.SS "\fBudev-persistent-net\fP *"
.IX Subsection "udev-persistent-net *"
Вилучити постійні правила мережі udev.
.PP
Вилучити постійні правила мережі udev, які відображають вже створену
MAC\-адресу гостьової системи на фіксований пристрій ethernet (наприклад
eth0).
.PP
Після клонування гостьової системи MAC\-адреса зазвичай змінюється. Оскільки
стару MAC\-адресу вже пов’язано зі старою назвою (наприклад eth0), це
означає, що нову MAC\-адресу буде пов’язано з новою назвою (наприклад eth1),
а це зазвичай є небажаним. За допомогою вилучення постійних правил мережі
udev цьому можна запобігти.
.SS "\fBuser-account\fP"
.IX Subsection "user-account"
Вилучити облікові записи користувачів у гостьовій системі.
.PP
Вилучити всі облікові записи користувачів та відповідні домашні
каталоги. Обліковий запис «root» вилучено не буде.
.SS "\fButmp\fP *"
.IX Subsection "utmp *"
Вилучити файл utmp.
.PP
У цьому файлі зберігаються записи щодо входу користувачів до машини. У
сучасних дистрибутивах Linux ці записи зберігаються на диску у пам’яті, тому
не є частиною віртуальної машини на диску, але ці дані зберігаються на диску
у старіших версіях дистрибутивів.
.SS "\fByum-uuid\fP *"
.IX Subsection "yum-uuid *"
Вилучити \s-1UUID\s0 yum.
.PP
Yum створить новий \s-1UUID\s0 під час наступного запуску, коли виявить, що
початковий \s-1UUID\s0 було вилучено.
.SH "КОПІЮВАННЯ ТА КЛОНУВАННЯ"
.IX Header "КОПІЮВАННЯ ТА КЛОНУВАННЯ"
Virt-sysprep can be used as part of a process of cloning guests, or to
prepare a template from which guests can be cloned.  There are many
different ways to achieve this using the virt tools, and this section is
just an introduction.
.PP
A virtual machine (when switched off) consists of two parts:
.IP "\fIналаштування\fR" 4
.IX Item "налаштування"
The configuration or description of the guest.  eg. The libvirt \s-1XML\s0 (see
\&\f(CW\*(C`virsh dumpxml\*(C'\fR), the running configuration of the guest, or another
external format like \s-1OVF\s0.
.Sp
Some configuration items that might need to be changed:
.RS 4
.IP "\(bu" 4
назва
.IP "\(bu" 4
\&\s-1UUID\s0
.IP "\(bu" 4
шлях до блокових пристроїв
.IP "\(bu" 4
MAC\-адреса мережевої картки
.RE
.RS 4
.RE
.IP "\fIблокові пристрої\fR" 4
.IX Item "блокові пристрої"
One or more hard disk images, themselves containing files, directories,
applications, kernels, configuration, etc.
.Sp
Some things inside the block devices that might need to be changed:
.RS 4
.IP "\(bu" 4
hostname and other net configuration
.IP "\(bu" 4
\&\s-1UUID\s0
.IP "\(bu" 4
\&\s-1SSH\s0 host keys
.IP "\(bu" 4
Windows unique security \s-1ID\s0 (\s-1SID\s0)
.IP "\(bu" 4
Puppet registration
.RE
.RS 4
.RE
.SS "КОПІЮВАННЯ БЛОКОВОГО ПРИСТРОЮ"
.IX Subsection "КОПІЮВАННЯ БЛОКОВОГО ПРИСТРОЮ"
Starting with an original guest, you probably wish to copy the guest block
device and its configuration to make a template.  Then once you are happy
with the template, you will want to make many clones from it.
.PP
.Vb 7
\&                        virt\-sysprep
\&                             |
\&                             v
\& original guest \-\-\-\-\-\-\-\-> template \-\-\-\-\-\-\-\-\-\->
\&                                      \e\-\-\-\-\-\-> cloned
\&                                       \e\-\-\-\-\-> guests
\&                                        \e\-\-\-\->
.Ve
.PP
You can, of course, just copy the block device on the host using \fIcp\fR\|(1) or
\&\fIdd\fR\|(1).
.PP
.Vb 5
\&                   dd                 dd
\& original guest \-\-\-\-\-\-\-\-> template \-\-\-\-\-\-\-\-\-\->
\&                                      \e\-\-\-\-\-\-> cloned
\&                                       \e\-\-\-\-\-> guests
\&                                        \e\-\-\-\->
.Ve
.PP
There are some smarter (and faster) ways too:
.PP
.Vb 5
\&                          snapshot
\&                template \-\-\-\-\-\-\-\-\-\->
\&                            \e\-\-\-\-\-\-> cloned
\&                             \e\-\-\-\-\-> guests
\&                              \e\-\-\-\->
.Ve
.PP
You may want to run virt-sysprep twice, once to reset the guest (to make a
template) and a second time to customize the guest for a specific user:
.PP
.Vb 6
\&                    virt\-sysprep        virt\-sysprep
\&                      (reset)      (add user, keys, logos)
\&                         |                   |
\&                 dd      v          dd       v
\& original guest \-\-\-\-> template \-\-\-\-\-\-\-\-\-> copied \-\-\-\-\-\-> custom
\&                                          template       guest
.Ve
.IP "\(bu" 4
Create a snapshot using qemu-img:
.Sp
.Vb 1
\& qemu\-img create \-f qcow2 \-o backing_file=original snapshot.qcow
.Ve
.Sp
The advantage is that you don't need to copy the original (very fast)  and
only changes are stored (less storage required).
.Sp
Note that writing to the backing file once you have created guests on top of
it is not possible: you will corrupt the guests.
.IP "\(bu" 4
Create a snapshot using \f(CW\*(C`lvcreate \-\-snapshot\*(C'\fR.
.IP "\(bu" 4
Other ways to create snapshots include using filesystems-level tools (for
filesystems such as btrfs).
.Sp
Most Network Attached Storage (\s-1NAS\s0) devices can also create cheap snapshots
from files or LUNs.
.IP "\(bu" 4
Get your \s-1NAS\s0 to duplicate the \s-1LUN\s0.  Most \s-1NAS\s0 devices can also duplicate LUNs
very cheaply (they copy them on-demand in the background).
.IP "\(bu" 4
Prepare your template using \fIvirt\-sparsify\fR\|(1).  See below.
.SS "VIRT-CLONE"
.IX Subsection "VIRT-CLONE"
A separate tool, \fIvirt\-clone\fR\|(1), can be used to duplicate the block device
and/or modify the external libvirt configuration of a guest.  It will reset
the name, \s-1UUID\s0 and \s-1MAC\s0 address of the guest in the libvirt \s-1XML\s0.
.PP
\&\fIvirt\-clone\fR\|(1) does not use libguestfs and cannot look inside the disk
image.  This was the original motivation to write virt-sysprep.
.SS "\s-1SPARSIFY\s0"
.IX Subsection "SPARSIFY"
.Vb 2
\&              virt\-sparsify
\& original guest \-\-\-\-\-\-\-\-> template
.Ve
.PP
\&\fIvirt\-sparsify\fR\|(1) can be used to make the cloning template smaller, making
it easier to compress and/or faster to copy.
.PP
Notice that since virt-sparsify also copies the image, you can use it to
make the initial copy (instead of \f(CW\*(C`dd\*(C'\fR).
.SS "ЗМІНА РОЗМІРІВ"
.IX Subsection "ЗМІНА РОЗМІРІВ"
.Vb 5
\&                         virt\-resize
\&                template \-\-\-\-\-\-\-\-\-\->
\&                            \e\-\-\-\-\-\-> cloned
\&                             \e\-\-\-\-\-> guests
\&                              \e\-\-\-\->
.Ve
.PP
If you want to give people cloned guests, but let them pick the size of the
guest themselves (eg. depending on how much they are prepared to pay for
disk space), then instead of copying the template, you can run
\&\fIvirt\-resize\fR\|(1).  Virt-resize performs a copy and resize, and thus is
ideal for cloning guests from a template.
.SH "FIRSTBOOT VS SCRIPT"
.IX Header "FIRSTBOOT VS SCRIPT"
The two options \fI\-\-firstboot\fR and \fI\-\-script\fR both supply shell scripts
that are run against the guest.  However these two options are significantly
different.
.PP
\&\fI\-\-firstboot script\fR uploads the file \f(CW\*(C`script\*(C'\fR into the guest and arranges
that it will run, in the guest, when the guest is next booted.  (The script
will only run once, at the \*(L"first boot\*(R").
.PP
\&\fI\-\-script script\fR runs the shell \f(CW\*(C`script\*(C'\fR \fIon the host\fR, with its current
directory inside the guest filesystem.
.PP
If you needed, for example, to \f(CW\*(C`yum install\*(C'\fR new packages, then you \fImust
not\fR use \fI\-\-script\fR for this, since that would (a) run the \f(CW\*(C`yum\*(C'\fR command
on the host and (b) wouldn't have access to the same resources
(repositories, keys, etc.) as the guest.  Any command that needs to run on
the guest \fImust\fR be run via \fI\-\-firstboot\fR.
.PP
On the other hand if you need to make adjustments to the guest filesystem
(eg. copying in files), then \fI\-\-script\fR is ideal since (a)  it has access
to the host filesystem and (b) you will get immediate feedback on errors.
.PP
Either or both options can be used multiple times on the command line.
.SH "БЕЗПЕКА"
.IX Header "БЕЗПЕКА"
Although virt-sysprep removes some sensitive information from the guest, it
does not pretend to remove all of it.  You should examine the \*(L"\s-1OPERATIONS\s0\*(R"
above and the guest afterwards.
.PP
Sensitive files are simply removed.  The data they contained may still exist
on the disk, easily recovered with a hex editor or undelete tool.  Use
\&\fIvirt\-sparsify\fR\|(1) as one way to remove this content.  See also the
\&\fIscrub\fR\|(1) command to get rid of deleted content in directory entries and
inodes.
.SS "БАЗА ВИПАДКОВОСТІ"
.IX Subsection "БАЗА ВИПАДКОВОСТІ"
\&\fI(Цей розділ стосується лише гостьових систем Linux)\fR
.PP
The virt-sysprep \f(CW\*(C`random\-seed\*(C'\fR operation writes a few bytes of randomness
from the host into the guest's random seed file.
.PP
If this is just done once and the guest is cloned from the same template,
then each guest will start with the same entropy, and things like \s-1SSH\s0 host
keys and \s-1TCP\s0 sequence numbers may be predictable.
.PP
Therefore you should arrange to add more randomness \fIafter\fR cloning from a
template too, which can be done by just enabling the \f(CW\*(C`random\-seed\*(C'\fR
operation:
.PP
.Vb 2
\& cp template.img newguest.img
\& virt\-sysprep \-\-enable random\-seed \-a newguest.img
.Ve
.SS "ПОВТОРНЕ ВСТАНОВЛЕННЯ МІТОК \s-1SELINUX\s0"
.IX Subsection "ПОВТОРНЕ ВСТАНОВЛЕННЯ МІТОК SELINUX"
\&\fI(Цей розділ стосується лише гостьових систем Linux, у яких
використовується лише SELinux)\fR
.PP
If any new files are created by virt-sysprep, then virt-sysprep touches
\&\f(CW\*(C`/.autorelabel\*(C'\fR so that these will be correctly labelled by SELinux the
next time the guest is booted.  This process interrupts boot and can take
some time.
.PP
You can force relabelling for all guests by supplying the
\&\fI\-\-selinux\-relabel\fR option.
.PP
You can disable relabelling entirely by supplying the
\&\fI\-\-no\-selinux\-relabel\fR option.
.SH "WINDOWS 8"
.IX Header "WINDOWS 8"
Windows 8 \*(L"fast startup\*(R" can prevent virt-sysprep from working.  See
\&\*(L"\s-1WINDOWS\s0 \s-1HIBERNATION\s0 \s-1AND\s0 \s-1WINDOWS\s0 8 \s-1FAST\s0 \s-1STARTUP\s0\*(R" in \fIguestfs\fR\|(3).
.SH "ЕКРАНУВАННЯ СИМВОЛІВ У ОБОЛОНЦІ"
.IX Header "ЕКРАНУВАННЯ СИМВОЛІВ У ОБОЛОНЦІ"
Libvirt guest names can contain arbitrary characters, some of which have
meaning to the shell such as \f(CW\*(C`#\*(C'\fR and space.  You may need to quote or
escape these characters on the command line.  See the shell manual page
\&\fIsh\fR\|(1) for details.
.SH "СТАН ВИХОДУ"
.IX Header "СТАН ВИХОДУ"
This program returns 0 on success, or 1 if there was an error.
.SH "ТАКОЖ ПЕРЕГЛЯНЬТЕ"
.IX Header "ТАКОЖ ПЕРЕГЛЯНЬТЕ"
\&\fIguestfs\fR\|(3), \fIguestfish\fR\|(1), \fIvirt\-clone\fR\|(1), \fIvirt\-rescue\fR\|(1),
\&\fIvirt\-resize\fR\|(1), \fIvirt\-sparsify\fR\|(1), \fIvirsh\fR\|(1), \fIlvcreate\fR\|(8),
\&\fIqemu\-img\fR\|(1), \fIscrub\fR\|(1), http://libguestfs.org/,
http://libvirt.org/.
.SH "АВТОРИ"
.IX Header "АВТОРИ"
Richard W.M. Jones http://people.redhat.com/~rjones/
.PP
Wanlong Gao, Fujitsu Ltd.
.SH "АВТОРСЬКІ ПРАВА"
.IX Header "АВТОРСЬКІ ПРАВА"
© Red Hat Inc., 2011–2012
.PP
Copyright (C) 2012 Fujitsu Ltd.
.SH "LICENSE"
.IX Header "LICENSE"
This program is free software; you can redistribute it and/or modify it
under the terms of the \s-1GNU\s0 General Public License as published by the
Free Software Foundation; either version 2 of the License, or (at your
option) any later version.
.PP
This program is distributed in the hope that it will be useful, but
\&\s-1WITHOUT\s0 \s-1ANY\s0 \s-1WARRANTY\s0; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS\s0 \s-1FOR\s0 A \s-1PARTICULAR\s0 \s-1PURPOSE\s0.  See the \s-1GNU\s0
General Public License for more details.
.PP
You should have received a copy of the \s-1GNU\s0 General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, \s-1MA\s0 02110\-1301 \s-1USA\s0.
.SH "BUGS"
.IX Header "BUGS"
To get a list of bugs against libguestfs, use this link:
https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&product=Virtualization+Tools
.PP
To report a new bug against libguestfs, use this link:
https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&product=Virtualization+Tools
.PP
When reporting a bug, please supply:
.IP "\(bu" 4
The version of libguestfs.
.IP "\(bu" 4
Where you got libguestfs (eg. which Linux distro, compiled from source, etc)
.IP "\(bu" 4
Describe the bug accurately and give a way to reproduce it.
.IP "\(bu" 4
Run \fIlibguestfs\-test\-tool\fR\|(1) and paste the \fBcomplete, unedited\fR
output into the bug report.
