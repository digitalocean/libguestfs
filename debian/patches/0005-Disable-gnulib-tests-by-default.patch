From: Hilko Bengen <bengen@debian.org>
Date: Sat, 1 Jun 2013 15:12:27 +0200
Subject: Disable gnulib tests by default

---
 Makefile.am  | 5 ++++-
 configure.ac | 9 +++++++++
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/Makefile.am b/Makefile.am
index 284eb63..c8d49b4 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -23,7 +23,10 @@ include $(top_srcdir)/common-rules.mk
 ACLOCAL_AMFLAGS = -I m4
 
 # Gnulib - must be built and tested before the library.
-SUBDIRS = gnulib/lib gnulib/tests
+SUBDIRS = gnulib/lib
+if ENABLE_GNULIB_TESTS
+SUBDIRS += gnulib/tests
+endif
 
 # Basic source for the library.
 SUBDIRS += tests/data generator src examples po
diff --git a/configure.ac b/configure.ac
index ae0b289..b4ce7b7 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1538,6 +1538,15 @@ PKG_CHECK_MODULES([BASH_COMPLETION], [bash-completion >= 2.0], [
 ])
 AM_CONDITIONAL([HAVE_BASH_COMPLETION],[test "x$bash_completion" = "xyes"])
 
+AC_ARG_ENABLE([gnulib-tests],
+    [AS_HELP_STRING([--disable-gnulib-tests],
+        [disable running GNU Portability library tests @<:@default=yes@:>@])],
+        [ENABLE_GNULIB_TESTS="$enableval"],
+        [ENABLE_GNULIB_TESTS=no])
+AM_CONDITIONAL([ENABLE_GNULIB_TESTS],[test "x$ENABLE_GNULIB_TESTS" = "xyes"])
+AC_MSG_RESULT([$ENABLE_GNULIB_TESTS])
+AC_SUBST([ENABLE_GNULIB_TESTS])
+
 dnl Library versioning.
 MAX_PROC_NR=`cat $srcdir/src/MAX_PROC_NR`
 AC_SUBST(MAX_PROC_NR)
