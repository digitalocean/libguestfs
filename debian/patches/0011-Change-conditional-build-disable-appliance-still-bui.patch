From: Hilko Bengen <bengen@debian.org>
Date: Thu, 7 Mar 2013 21:41:51 +0100
Subject: Change conditional build: --disable-appliance still builds the
 libguestfs-specific parts of the appliance.

---
 Makefile.am           |    2 --
 appliance/Makefile.am |   14 +++++++++++---
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 842008a..a069223 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -30,9 +30,7 @@ SUBDIRS += tests/data generator src examples po
 if ENABLE_DAEMON
 SUBDIRS += daemon
 endif
-if ENABLE_APPLIANCE
 SUBDIRS += appliance
-endif
 
 # Tests - order is important.
 if ENABLE_APPLIANCE
diff --git a/appliance/Makefile.am b/appliance/Makefile.am
index 169ea15..8661bf4 100644
--- a/appliance/Makefile.am
+++ b/appliance/Makefile.am
@@ -35,12 +35,20 @@ superminfsdir = $(prefix)/lib/guestfs/supermin.d
 
 fs_DATA =
 superminfs_DATA = \
-	supermin.d/base.img \
-	supermin.d/daemon.img \
 	supermin.d/init.img \
-	supermin.d/hostfiles \
 	supermin.d/udev-rules.img
 
+if ENABLE_DAEMON
+superminfs_DATA += \
+	supermin.d/daemon.img
+endif
+
+if ENABLE_APPLIANCE
+superminfs_DATA += \
+	supermin.d/base.img \
+	supermin.d/hostfiles
+endif
+
 # This used to be a configure-generated file (as is update.sh still).
 # However config.status always touches the destination file, which
 # means the appliance got rebuilt too often.
