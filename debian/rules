#!/usr/bin/make -f

DEB_PYTHON_SYSTEM=pysupport
DEB_DH_INSTALL_SOURCEDIR = debian/tmp

MIRROR=http://apt:9999/debian
REPO=sid

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

DEB_CONFIGURE_EXTRA_FLAGS := \
	--with-readline		\
	--with-repo=${REPO}     \
        --with-mirror=${MIRROR}

DEB_DBG_PACKAGES = libguestfs0-dbg
DEB_PYTHON_SETUP_CMD := /dev/null

install/python-guestfs::
	rm -f debian/tmp/usr/lib/python*/*/libguestfsmod.so
	for mod in debian/tmp/usr/lib/python*/*/libguestfsmod.so.0.0.0; do \
		mv $${mod} $$(dirname $${mod})/libguestfsmod.so; \
	done

debian/autogen.stamp:
	./autogen.sh
	touch debian/autogen.stamp

post-patches:: debian/autogen.stamp

clean::
	rm -rf appliance/debian/root \
	       appliance/debian/nest \
	       appliance/debian/vmlinuz-* \
	       appliance/debian/*.cgz \
	       appliance/*.bak
	rm -f src/.pod2text.data po/*.gmo
	rm -f debian/autogen.stamp
